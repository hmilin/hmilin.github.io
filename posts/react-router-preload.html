<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Meiling&#x27;s Blog</title><meta name="description" content="meilingçš„åšå®¢"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/56ac636d8286ddc4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/56ac636d8286ddc4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/a85178c7df1bcd20.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a85178c7df1bcd20.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-c50d706355616eef.js" defer=""></script><script src="/_next/static/chunks/framework-a85322f027b40e20.js" defer=""></script><script src="/_next/static/chunks/main-95aa3232ca423ead.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c28c633855fb2140.js" defer=""></script><script src="/_next/static/chunks/495-31a10f133dd42cb0.js" defer=""></script><script src="/_next/static/chunks/785-afa51abc884a1702.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-aa35ebeedcc516ae.js" defer=""></script><script src="/_next/static/OKE3GmY2jrZso7TnNn3Ue/_buildManifest.js" defer=""></script><script src="/_next/static/OKE3GmY2jrZso7TnNn3Ue/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_container__XDtoS"><header class="Header_header__aO32P"><div class="Header_mobileNav__x8dOm"><div class="Header_menuIcon__zsaJW"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M120-240v-80h720v80zm0-200v-80h720v80zm0-200v-80h720v80z"></path></svg></div><a class="Header_searchBtn__DiCC5" href="/search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580t75.5-184.5T380-840t184.5 75.5T640-580q0 44-14 83t-38 69l252 252zM380-400q75 0 127.5-52.5T560-580t-52.5-127.5T380-760t-127.5 52.5T200-580t52.5 127.5T380-400"></path></svg></a></div><nav class="Header_nav__wk8Zc"><div class="Header_closeIcon__TBNuf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224z"></path></svg></div><a class="Header_searchBtn__DiCC5" href="/search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580t75.5-184.5T380-840t184.5 75.5T640-580q0 44-14 83t-38 69l252 252zM380-400q75 0 127.5-52.5T560-580t-52.5-127.5T380-760t-127.5 52.5T200-580t52.5 127.5T380-400"></path></svg></a><a class="" href="/"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M200-160v-366L88-440l-48-64 440-336 160 122v-82h120v174l160 122-48 64-112-86v366H520v-240h-80v240zm80-80h80v-240h240v240h80v-347L480-739 280-587zm120-319h160q0-32-24-52.5T480-632t-56 20.5-24 52.5m-40 319v-240h240v240-240H360z"></path></svg></div><div class="Header_title__BTC6R">é¦–é¡µ</div></a><a class="" href="/category/native"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M200-640v440h560v-440H640v320l-160-80-160 80v-320zm0 520q-33 0-56.5-23.5T120-200v-499q0-14 4.5-27t13.5-24l50-61q11-14 27.5-21.5T250-840h460q18 0 34.5 7.5T772-811l50 61q9 11 13.5 24t4.5 27v499q0 33-23.5 56.5T760-120zm16-600h528l-34-40H250zm184 80v190l80-40 80 40v-190zm-200 0h560z"></path></svg></div><div class="Header_title__BTC6R">åŸç”ŸåŸºç¡€</div></a><a class="" href="/category/framework"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M400-400h160v-80H400zm0-120h320v-80H400zm0-120h320v-80H400zm-80 400q-33 0-56.5-23.5T240-320v-480q0-33 23.5-56.5T320-880h480q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240zm0-80h480v-480H320zM160-80q-33 0-56.5-23.5T80-160v-560h80v560h560v80zm160-720v480z"></path></svg></div><div class="Header_title__BTC6R">æ¡†æ¶ç›¸å…³</div></a><a class="" href="/category/tool"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="m620-284 56-56q6-6 6-14t-6-14L540-505q4-11 6-22t2-25q0-57-40.5-97.5T410-690q-17 0-34 4.5T343-673l94 94-56 56-94-94q-8 16-12.5 33t-4.5 34q0 57 40.5 97.5T408-412q13 0 24.5-2t22.5-6l137 136q6 6 14 6t14-6M480-80q-83 0-156-31.5T197-197t-85.5-127T80-480t31.5-156T197-763t127-85.5T480-880t156 31.5T763-763t85.5 127T880-480t-31.5 156T763-197t-127 85.5T480-80m0-80q134 0 227-93t93-227-93-227-227-93-227 93-93 227 93 227 227 93m0-320"></path></svg></div><div class="Header_title__BTC6R">å·¥å…·ä½¿ç”¨</div></a><a class="" href="/category/performance"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M220-520 80-600v-160l140-80 140 80v160zm0-92 60-34v-68l-60-34-60 34v68zm440 123v-93l140 82v280L560-80 320-220v-280l140-82v93l-60 35v188l160 93 160-93v-188zm-140 89v-480h360l-80 120 80 120H600v240zM220-680"></path></svg></div><div class="Header_title__BTC6R">æ€§èƒ½æå‡</div></a><a class="" href="/about"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M360-390q-21 0-35.5-14.5T310-440t14.5-35.5T360-490t35.5 14.5T410-440t-14.5 35.5T360-390m240 0q-21 0-35.5-14.5T550-440t14.5-35.5T600-490t35.5 14.5T650-440t-14.5 35.5T600-390M480-160q134 0 227-93t93-227q0-24-3-46.5T786-570q-21 5-42 7.5t-44 2.5q-91 0-172-39T390-708q-32 78-91.5 135.5T160-486v6q0 134 93 227t227 93m0 80q-83 0-156-31.5T197-197t-85.5-127T80-480t31.5-156T197-763t127-85.5T480-880t156 31.5T763-763t85.5 127T880-480t-31.5 156T763-197t-127 85.5T480-80m-54-715q42 70 114 112.5T700-640q14 0 27-1.5t27-3.5q-42-70-114-112.5T480-800q-14 0-27 1.5t-27 3.5M177-581q51-29 89-75t57-103q-51 29-89 75t-57 103m146-178"></path></svg></div><div class="Header_title__BTC6R">å…³äº</div></a></nav></header><div><main><div class="Layout_cover__vC5GW"><div><h1>Reactä¸­çš„é¢„åŠ è½½ç­–ç•¥</h1><p>Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”ï¼Œä»¥åŠåœ¨ä½¿ç”¨react-routeræ—¶å¦‚ä½•è¿›è¡Œé¢„åŠ è½½è®¾ç½®</p><div>2024-08-26 10:13:00</div></div></div><div class="content-container"><h1 id="Reactä¸­çš„é¢„åŠ è½½ç­–ç•¥"><a href="#Reactä¸­çš„é¢„åŠ è½½ç­–ç•¥" class="mr-2">#</a>Reactä¸­çš„é¢„åŠ è½½ç­–ç•¥</h1>
<p>åœ¨ç°ä»£å‰ç«¯é¡¹ç›®ä¸­ï¼Œæ„å»ºå·¥å…·ä¼šæ ¹æ®æ–‡ä»¶é—´å¯¼å…¥çš„å…³ç³»å’Œç”¨æˆ·çš„è‡ªå®šä¹‰ç­–ç•¥è¿›è¡Œåˆ†åŒ…ï¼Œå¹¶ç»“åˆç»„ä»¶æ‡’åŠ è½½å’ŒåŠ¨æ€å¯¼å…¥ç­‰å‡½æ•°å£°æ˜ï¼Œè®©é¡µé¢åœ¨åˆ°è¾¾æŒ‡å®šè·¯ç”±ä¸‹ï¼Œå†åŠ è½½ç›¸åº”çš„æ–‡ä»¶ã€‚
è¿›è¡Œè·¯ç”±é¢„åŠ è½½è®¾ç½®ä¸»è¦æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p>
<ol>
<li>æå‡é¡µé¢åŠ è½½æ€§èƒ½ã€‚ç”¨æˆ·é¦–æ¬¡è¿›å…¥é¡µé¢æ—¶ï¼ŒåªåŠ è½½å¿…è¦çš„æ–‡ä»¶ï¼Œå¯æå‡é¦–å±çš„åŠ è½½é€Ÿåº¦ï¼Œä¸»è¦å¯¹LCPçš„æ—¶é—´æœ‰æ˜æ˜¾æå‡ã€‚</li>
<li>æå‡ç¨³å®šæ€§ã€‚å½“åº”ç”¨ç‰ˆæœ¬æ›´æ–°åï¼Œé™æ€æ–‡ä»¶çš„hashå€¼å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼ŒåŸæ¥çš„æ–‡ä»¶å¯èƒ½è·å–ä¸åˆ°ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç‰ˆæœ¬æ›´æ–°å‰æ‰“å¼€é¡µé¢ï¼Œå½“è·¯ç”±è·³è½¬æ—¶æ˜¯ä¸ä¼šé‡æ–°è·å–é™æ€æ–‡ä»¶åœ°å€åˆ—è¡¨ï¼Œè¿™æ—¶é¡µé¢å¯èƒ½ä¼šå› ä¸ºæ‰¾ä¸åˆ°æ–‡ä»¶è€Œæ— æ³•ç»§ç»­ä½¿ç”¨ï¼Œç”¨æˆ·åªèƒ½é€šè¿‡åˆ·æ–°é¡µé¢æ¥è§£å†³ã€‚</li>
</ol>
<h2 id="linkæ ‡ç­¾çš„prefetchå’Œpreloadæ¨¡å¼"><a href="#linkæ ‡ç­¾çš„prefetchå’Œpreloadæ¨¡å¼" class="mr-2">#</a>linkæ ‡ç­¾çš„prefetchå’Œpreloadæ¨¡å¼</h2>
<p>åœ¨åŸç”Ÿhtmlæ–‡ä»¶ä¸­ï¼Œlinkæ ‡ç­¾ç”¨äºåŠ è½½å¤–éƒ¨èµ„æºï¼Œç†è§£linkæ ‡ç­¾å¯¹èµ„æºåŠ è½½æ—¶æœºçš„è®¾è®¡ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£è·¯ç”±é¢„åŠ è½½ç­–ç•¥çš„è®¾è®¡æ€è·¯ã€‚åœ¨ä½¿ç”¨linkæ ‡ç­¾æ¥åŠ è½½æ–‡ä»¶æ—¶ï¼Œrelå‚æ•°çš„<code>prefetch</code>å’Œ<code>preload</code>æ¨¡å¼éƒ½æ˜¯å’Œæ‡’åŠ è½½ç›¸å…³çš„å‚æ•°ï¼Œä»–ä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<p>prefetch: ç”¨äºé¢„è·å–ä¸‹ä¸€ä¸ªé¡µé¢éœ€è¦çš„æ–‡ä»¶ï¼Œè¯·æ±‚çš„ä¼˜å…ˆçº§ä¸€èˆ¬ä¸ºLowest</p>
<p>preload: ç”¨äºåŠ è½½å½“å‰é¡µé¢å¾ˆå¿«å°±éœ€è¦çš„æ–‡ä»¶ï¼Œåœ¨é¡µé¢ç”Ÿå‘½å‘¨æœŸå¼€å§‹ä¹‹å‰å°±ä¼šè§¦å‘è¯·æ±‚ï¼Œå½“åŠ è½½jsæ–‡ä»¶æ—¶ï¼Œè¯·æ±‚ä¼˜å…ˆçº§ä¸ºHighï¼ŒåŠ è½½cssæ–‡ä»¶æ—¶ä¼˜å…ˆçº§ä¸ºHighest</p>
<h2 id="Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”"><a href="#Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”" class="mr-2">#</a>Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”</h2>
<ol>
<li>ReactRouter</li>
</ol>
<p>æ²¡æœ‰å¯¹é¢„åŠ è½½çš„å®ç°ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªå®šä¹‰</p>
<ol start="2">
<li>Nextjs</li>
</ol>
<p>åœ¨Linkç»„ä»¶ä¸Šé€šè¿‡<code>prefetch</code>ä¼ å‚æ¥å®šä¹‰æ˜¯å¦å¼€å¯é¢„åŠ è½½ï¼Œè®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œå½“linkç»„ä»¶æ¸²æŸ“åœ¨å¯è§†èŒƒå›´å†…ï¼Œå¼€å§‹é¢„åŠ è½½ç›¸å…³æ–‡ä»¶ï¼Œè¿™ç§é¢„åŠ è½½æ¨¡å¼æ¯”è¾ƒæ¥è¿‘åŸç”Ÿ<link/>çš„prefetchæ¨¡å¼ã€‚</p>
<ol start="3">
<li>
<p>TanStack Router</p>
</li>
<li>
<p>å¯å…¨å±€è®¾ç½®é»˜è®¤é¢„åŠ è½½ç­–ç•¥ï¼Œä¹Ÿå¯åŸºäºLinkä¸ªæ€§åŒ–</p>
</li>
<li>
<p>ç›®å‰å·²æä¾›äº†ä¸¤ç§é¢„åŠ è½½ç­–ç•¥ï¼š<code>intent</code>å’Œ<code>viewport</code> ï¼Œå‰è€…ä¼šåœ¨hoveråˆ°<code>Link</code>ç»„ä»¶æ—¶åŠ è½½ç»„ä»¶ï¼Œåè€…è·ŸNextjsçš„æ–¹æ¡ˆç›¸ä¼¼ï¼Œåœ¨<code>Link</code>ç»„ä»¶è¿›å…¥è§†å›¾ä¸­åŠ è½½ç»„ä»¶</p>
</li>
</ol>
<h2 id="ä½¿ç”¨ReactRouterå¦‚ä½•è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥"><a href="#ä½¿ç”¨ReactRouterå¦‚ä½•è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥" class="mr-2">#</a>ä½¿ç”¨ReactRouterå¦‚ä½•è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥</h2>
<h3 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="mr-2">#</a>åŸºæœ¬æ€è·¯</h3>
<ol>
<li>æ‰©å±•<code>react-router</code>çš„<code>Link</code>ç»„ä»¶ï¼Œå¢åŠ preloadå‚æ•°ï¼Œæ”¯æŒ<code>&#x27;intent&#x27;</code>å’Œ<code>&#x27;viewport&#x27;</code>ä¸¤ç§ç­–ç•¥ã€‚</li>
<li>å®šä¹‰ä¸€ä¸ª<code>lazyLoad</code>å‡½æ•°æ›¿æ¢<code>React.lazy</code>ï¼Œè¿”å›å¯¹è±¡ä¸­å¢åŠ <code>preload</code>æ–¹æ³•ï¼Œç”¨äºæ‰‹åŠ¨è°ƒç”¨ã€‚</li>
<li>åœ¨å£°æ˜routeé…ç½®æ—¶å£°æ˜Componentå‚æ•°ä¸ºï¼š<code>lazyLoad(() =&gt; import(&#x27;@src/pages/xxx&#x27;))</code>ã€‚</li>
<li>Linkç»„ä»¶ä¸­æ ¹æ®ä¼ å…¥çš„<code>to</code>æ‹¿åˆ°ç›¸åº”çš„<code>Component</code>ä¹‹åå³å¯è°ƒç”¨æ­¥éª¤2å£°æ˜çš„preloadæ–¹æ³•ï¼Œå¹¶æ ¹æ®æŒ‡å®šçš„ç­–ç•¥æ¥å†³å®šè°ƒç”¨çš„æ—¶æœºã€‚</li>
</ol>
<h3 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="mr-2">#</a>å…·ä½“å®ç°</h3>
<p><code>Link</code>ç»„ä»¶:</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">import</span><span> useForkRef </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@/hooks/useForkRef&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { useIntersectionObserver } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@/hooks/useIntersectionObserver&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> </span><span style="color:#b48ead">type</span><span> { ComponentType } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;react&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { forwardRef, useCallback, useRef } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;react&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> </span><span style="color:#b48ead">type</span><span> { LinkProps </span><span style="color:#b48ead">as</span><span> RouterLinkProps } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;react-router-dom&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { Link </span><span style="color:#b48ead">as</span><span> RouterLink, matchRoutes } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;react-router-dom&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> useRoutesData </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;../RoutesProvider/useRoutesData&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> </span><span style="color:#b48ead">type</span><span> { LazyLoadResult } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@/utils/lazy&#x27;</span><span>;
</span>
<span></span><span style="color:#b48ead">interface</span><span> LinkProps </span><span style="color:#b48ead">extends</span><span> RouterLinkProps {
</span><span>  </span><span style="color:#65737e">/** preload strategy */</span><span>
</span><span>  preload?: </span><span style="color:#a3be8c">&#x27;intent&#x27;</span><span> | </span><span style="color:#a3be8c">&#x27;viewport&#x27;</span><span> | </span><span style="color:#d08770">false</span><span>;
</span>}
<!-- -->
<span></span><span style="color:#65737e">/**
</span><span class="hljs-function" style="color:#d08770"> * åŸºäºreact-router-domçš„Linkç»„ä»¶å®ç°äº†preloadåŠŸèƒ½
</span><span style="color:#65737e"> */</span><span>
</span><span></span><span style="color:#b48ead">const</span><span> Link = forwardRef&lt;HTMLAnchorElement, LinkProps&gt;(</span><span class="hljs-function" style="color:#b48ead">function</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#8fa1b3">Link</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">
</span><span class="hljs-function" style="color:#d08770">  { preload, onMouseEnter, ...props },
</span><span class="hljs-function" style="color:#d08770">  forwardedRef,
</span><span class="hljs-function" style="color:#d08770"></span><span class="hljs-function">) </span><span>{
</span><span>  </span><span style="color:#b48ead">const</span><span> preloadedComponent = useRef&lt;ComponentType&gt;();
</span><span>  </span><span style="color:#b48ead">const</span><span> elementRef = useRef&lt;HTMLAnchorElement | </span><span style="color:#d08770">null</span><span>&gt;(</span><span style="color:#d08770">null</span><span>);
</span><span>  </span><span style="color:#b48ead">const</span><span> mergedRef = useForkRef(elementRef, forwardedRef);
</span>
<span>  </span><span style="color:#65737e">// æ‹¿åˆ°æ‰€æœ‰routesé…ç½®</span><span>
</span><span>  </span><span style="color:#b48ead">const</span><span> routes = useRoutesData();
</span>
<span>  </span><span style="color:#65737e">// preload component</span><span>
</span><span>  </span><span style="color:#b48ead">const</span><span> preloadComponent = useCallback(</span><span class="hljs-function">() =&gt;</span><span> {
</span><span>    </span><span style="color:#b48ead">if</span><span> (!preloadedComponent.current) {
</span><span>      </span><span style="color:#b48ead">const</span><span> matches = matchRoutes(routes, props.to);
</span><span>      matches?.forEach(</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">route</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>        </span><span style="color:#b48ead">const</span><span> loader = (route.route.Component </span><span style="color:#b48ead">as</span><span> LazyLoadResult)?.preload;
</span><span>        </span><span style="color:#b48ead">if</span><span> (loader) {
</span><span>          loader().then(</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">module</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>            preloadedComponent.current = </span><span style="color:#d08770">module</span><span>.default;
</span>          });
<!-- -->        }
<!-- -->      });
<!-- -->    }
<!-- -->  }, [props.to, routes]);
<!-- -->
<span>  </span><span style="color:#b48ead">const</span><span> handleMouseEnter: React.MouseEventHandler&lt;HTMLAnchorElement&gt; = useCallback(
</span><span>    </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">e</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>      </span><span style="color:#b48ead">if</span><span> (preload === </span><span style="color:#a3be8c">&#x27;intent&#x27;</span><span>) {
</span>        preloadComponent();
<!-- -->      }
<!-- -->      onMouseEnter?.(e);
<!-- -->    },
<!-- -->    [preloadComponent, onMouseEnter, preload],
<!-- -->  );
<!-- -->
<span>  </span><span style="color:#b48ead">const</span><span> preloadViewportIoCallback = useCallback(
</span><span>    </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">entry: IntersectionObserverEntry | </span><span class="hljs-function" style="color:#d08770">undefined</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>      </span><span style="color:#b48ead">if</span><span> (entry?.isIntersecting) {
</span>        preloadComponent();
<!-- -->      }
<!-- -->    },
<!-- -->    [preloadComponent],
<!-- -->  );
<!-- -->
<!-- -->  useIntersectionObserver&lt;HTMLAnchorElement&gt;(
<!-- -->    elementRef,
<!-- -->    preloadViewportIoCallback,
<!-- -->    {},
<span>    { </span><span class="hljs-attr">disabled</span><span>: preload !== </span><span style="color:#a3be8c">&#x27;viewport&#x27;</span><span> },
</span>  );
<!-- -->
<span>  </span><span style="color:#b48ead">return</span><span> </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">RouterLink</span><span class="xml" style="color:#bf616a"> </span><span class="xml hljs-attr" style="color:#bf616a">ref</span><span class="xml" style="color:#bf616a">=</span><span class="xml" style="color:#a3be8c">{mergedRef}</span><span class="xml" style="color:#bf616a"> {</span><span class="xml hljs-attr" style="color:#bf616a">...props</span><span class="xml" style="color:#bf616a">} </span><span class="xml hljs-attr" style="color:#bf616a">onMouseEnter</span><span class="xml" style="color:#bf616a">=</span><span class="xml" style="color:#a3be8c">{handleMouseEnter}</span><span class="xml" style="color:#bf616a"> /&gt;</span><span>;
</span>});
<!-- -->
<span></span><span style="color:#b48ead">export</span><span> </span><span style="color:#b48ead">default</span><span> Link;
</span></code></pre>
<p><code>lazyLoad</code>å‡½æ•°ï¼š</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">import</span><span> </span><span style="color:#b48ead">type</span><span> { ComponentType, LazyExoticComponent } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;react&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { lazy } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;react&#x27;</span><span>;
</span>
<span></span><span style="color:#b48ead">export</span><span> </span><span style="color:#b48ead">type</span><span> LazyLoadResult&lt;T </span><span style="color:#b48ead">extends</span><span> ComponentType&lt;</span><span style="color:#d08770">any</span><span>&gt; = ComponentType&lt;</span><span style="color:#d08770">any</span><span>&gt;&gt; =
</span>  LazyExoticComponent&lt;T&gt; &amp; {
<span>    </span><span class="hljs-attr">preload</span><span>: </span><span class="hljs-function">() =&gt;</span><span> </span><span style="color:#d08770">Promise</span><span>&lt;{ </span><span class="hljs-attr">default</span><span>: T }&gt;;
</span>  };
<!-- -->
<span></span><span style="color:#b48ead">export</span><span> </span><span class="hljs-function" style="color:#b48ead">function</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#8fa1b3">lazyLoad</span><span class="hljs-function">&lt;</span><span class="hljs-function" style="color:#8fa1b3">T</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#8fa1b3">extends</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#8fa1b3">ComponentType</span><span class="hljs-function">&lt;</span><span class="hljs-function" style="color:#8fa1b3">any</span><span class="hljs-function">&gt;&gt;(</span><span class="hljs-function" style="color:#d08770">
</span><span class="hljs-function" style="color:#d08770">  load: () =&gt; </span><span class="hljs-function" style="color:#d08770">Promise</span><span class="hljs-function" style="color:#d08770">&lt;{ </span><span class="hljs-function" style="color:#b48ead">default</span><span class="hljs-function" style="color:#d08770">: T }&gt;,
</span><span class="hljs-function" style="color:#d08770"></span><span class="hljs-function">): </span><span class="hljs-function" style="color:#8fa1b3">LazyLoadResult</span><span class="hljs-function">&lt;</span><span class="hljs-function" style="color:#8fa1b3">T</span><span class="hljs-function">&gt; </span><span>{
</span><span>  </span><span style="color:#b48ead">let</span><span> preloaded = </span><span style="color:#d08770">false</span><span>;
</span><span>  </span><span style="color:#b48ead">let</span><span> loadedComponent: { </span><span class="hljs-attr">default</span><span>: T };
</span><span>  </span><span style="color:#b48ead">const</span><span> loadComponent = </span><span style="color:#b48ead">async</span><span> () =&gt; {
</span><span>    </span><span style="color:#b48ead">if</span><span> (preloaded) </span><span style="color:#b48ead">return</span><span> loadedComponent;
</span><span>    loadedComponent = </span><span style="color:#b48ead">await</span><span> load().then(</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">res</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>      preloaded = </span><span style="color:#d08770">true</span><span>;
</span><span>      </span><span style="color:#b48ead">return</span><span> res;
</span>    });
<span>    </span><span style="color:#b48ead">return</span><span> loadedComponent;
</span>  };
<span>  </span><span style="color:#b48ead">const</span><span> preload = loadComponent;
</span><span>  </span><span style="color:#b48ead">const</span><span> lazyComponent: </span><span style="color:#d08770">any</span><span> = lazy(loadComponent);
</span>  lazyComponent.preload = preload;
<!-- -->
<span>  </span><span style="color:#b48ead">return</span><span> lazyComponent </span><span style="color:#b48ead">as</span><span> LazyLoadResult&lt;T&gt;;
</span>}
</code></pre>
<p><code>routes</code>æ–‡ä»¶:</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">import</span><span> Loading </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@/components/Loading&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> Layout </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@/components/layouts&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { lazyLoad } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@/utils/lazy&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> </span><span style="color:#b48ead">type</span><span> { RouteObject } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;react-router-dom&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { Navigate } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;react-router-dom&#x27;</span><span>;
</span>
<span></span><span style="color:#b48ead">const</span><span> Home = lazyLoad(</span><span class="hljs-function">() =&gt;</span><span> </span><span style="color:#b48ead">import</span><span>(</span><span style="color:#a3be8c">&#x27;@/pages/Home&#x27;</span><span>));
</span><span></span><span style="color:#b48ead">const</span><span> routes: RouteObject[] = [
</span>  {
<span>    </span><span class="hljs-attr">path</span><span>: </span><span style="color:#a3be8c">&#x27;/&#x27;</span><span>,
</span><span>    </span><span class="hljs-attr">element</span><span>: </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">Layout</span><span class="xml" style="color:#bf616a"> /&gt;</span><span>,
</span>    children: [
<!-- -->      {
<span>        </span><span class="hljs-attr">index</span><span>: </span><span style="color:#d08770">true</span><span>,
</span><span>        </span><span class="hljs-attr">element</span><span>: </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">Navigate</span><span class="xml" style="color:#bf616a"> </span><span class="xml hljs-attr" style="color:#bf616a">to</span><span class="xml" style="color:#bf616a">=</span><span class="xml" style="color:#a3be8c">&quot;/home&quot;</span><span class="xml" style="color:#bf616a"> /&gt;</span><span>,
</span>      },
<!-- -->      {
<span>        </span><span class="hljs-attr">path</span><span>: </span><span style="color:#a3be8c">&#x27;home&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">Component</span><span>: Home,
</span>      },
<!-- -->    ],
<!-- -->  },
<!-- -->];
<!-- -->
<span></span><span style="color:#b48ead">export</span><span> </span><span style="color:#b48ead">default</span><span> routes;
</span></code></pre>
<p>å…·ä½“ä»£ç å®ç°å¯å‚è€ƒæ¨¡æ¿é¡¹ç›®ï¼š<a href="https://github.com/hmilin/react-vite-template">hmilin/react-vite-template</a></p>
<h2 id="ä¸ºä»€ä¹ˆæ’ä»¶,[object Object],å¯¹åŠ è½½æ€§èƒ½æå‡æ— æ•ˆ"><a href="#ä¸ºä»€ä¹ˆæ’ä»¶,[object Object],å¯¹åŠ è½½æ€§èƒ½æå‡æ— æ•ˆ" class="mr-2">#</a>ä¸ºä»€ä¹ˆæ’ä»¶<code>vite-plugin-preload</code>å¯¹åŠ è½½æ€§èƒ½æå‡æ— æ•ˆ</h2>
<p>åœ¨<code>vite+react</code>é¡¹ç›®ä¸­è§£å†³é¢„åŠ è½½é—®é¢˜æ—¶ï¼Œçœ‹åˆ°æ’ä»¶<code>vite-plugin-preload</code>ï¼Œä½†æ˜¯çœ‹äº†ä»–çš„å…·ä½“å®ç°æ–¹å¼å‘ç°å¹¶ä¸èƒ½è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚åŸå› æ˜¯ï¼šä½¿ç”¨<code>vite-plugin-preload</code>æ’ä»¶åï¼Œæ‰€æœ‰åŸå…ˆåŠ¨æ€åŠ è½½çš„æ¨¡å—éƒ½ä¼šä½¿ç”¨<code>&lt;link rel=&quot;modulepreload&quot; href=&quot;xxx.js&quot; /&gt;</code>åŠ åˆ°å…¥å£htmlæ–‡ä»¶ä¸­ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶ï¼Œå°†åœ¨ç¬¬ä¸€æ—¶é—´åŠ è½½æ‰€æœ‰æ¨¡å—æ–‡ä»¶ï¼Œä¸”è¯·æ±‚ä¼˜å…ˆçº§ä¸ºHighã€‚å½“é¡¹ç›®æ¯”è¾ƒåºå¤§æ—¶ï¼Œé¦–å±åŠ è½½æ—¶é—´å°†ä¼šå˜å¾—å¾ˆå¤§ã€‚</p><div class="styles_catalogue-container__i6Zhk"><div class="styles_skeleton-container__qbEBJ"><div class="styles_skeleton__p5JvS" data-level="2"></div><div class="styles_skeleton__p5JvS" data-level="2"></div><div class="styles_skeleton__p5JvS" data-level="2"></div><div class="styles_skeleton__p5JvS" data-level="3"></div><div class="styles_skeleton__p5JvS" data-level="3"></div><div class="styles_skeleton__p5JvS" data-level="2"></div></div><nav class="styles_navigation__NkDRt"><ul><li class="" data-level="2"><a href="#linkæ ‡ç­¾çš„prefetchå’Œpreloadæ¨¡å¼">linkæ ‡ç­¾çš„prefetchå’Œpreloadæ¨¡å¼</a></li><li class="" data-level="2"><a href="#Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”">Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”</a></li><li class="" data-level="2"><a href="#ä½¿ç”¨ReactRouterå¦‚ä½•è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥">ä½¿ç”¨ReactRouterå¦‚ä½•è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥</a></li><li class="" data-level="3"><a href="#åŸºæœ¬æ€è·¯">åŸºæœ¬æ€è·¯</a></li><li class="" data-level="3"><a href="#å…·ä½“å®ç°">å…·ä½“å®ç°</a></li><li class="" data-level="2"><a href="#ä¸ºä»€ä¹ˆæ’ä»¶å¯¹åŠ è½½æ€§èƒ½æå‡æ— æ•ˆ">ä¸ºä»€ä¹ˆæ’ä»¶å¯¹åŠ è½½æ€§èƒ½æå‡æ— æ•ˆ</a></li></ul></nav></div></div><div class="content-container"></div></main><footer class="grid place-items-center pb-4"><a href="https://github.com/hmilin" target="_blank" rel="noreferrer noopener">ğŸ˜˜Github</a></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    ol: \"ol\",\n    li: \"li\",\n    h2: \"h2\",\n    code: \"code\",\n    h3: \"h3\",\n    pre: \"pre\",\n    a: \"a\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"Reactä¸­çš„é¢„åŠ è½½ç­–ç•¥\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åœ¨ç°ä»£å‰ç«¯é¡¹ç›®ä¸­ï¼Œæ„å»ºå·¥å…·ä¼šæ ¹æ®æ–‡ä»¶é—´å¯¼å…¥çš„å…³ç³»å’Œç”¨æˆ·çš„è‡ªå®šä¹‰ç­–ç•¥è¿›è¡Œåˆ†åŒ…ï¼Œå¹¶ç»“åˆç»„ä»¶æ‡’åŠ è½½å’ŒåŠ¨æ€å¯¼å…¥ç­‰å‡½æ•°å£°æ˜ï¼Œè®©é¡µé¢åœ¨åˆ°è¾¾æŒ‡å®šè·¯ç”±ä¸‹ï¼Œå†åŠ è½½ç›¸åº”çš„æ–‡ä»¶ã€‚\\nè¿›è¡Œè·¯ç”±é¢„åŠ è½½è®¾ç½®ä¸»è¦æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"æå‡é¡µé¢åŠ è½½æ€§èƒ½ã€‚ç”¨æˆ·é¦–æ¬¡è¿›å…¥é¡µé¢æ—¶ï¼ŒåªåŠ è½½å¿…è¦çš„æ–‡ä»¶ï¼Œå¯æå‡é¦–å±çš„åŠ è½½é€Ÿåº¦ï¼Œä¸»è¦å¯¹LCPçš„æ—¶é—´æœ‰æ˜æ˜¾æå‡ã€‚\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"æå‡ç¨³å®šæ€§ã€‚å½“åº”ç”¨ç‰ˆæœ¬æ›´æ–°åï¼Œé™æ€æ–‡ä»¶çš„hashå€¼å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼ŒåŸæ¥çš„æ–‡ä»¶å¯èƒ½è·å–ä¸åˆ°ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç‰ˆæœ¬æ›´æ–°å‰æ‰“å¼€é¡µé¢ï¼Œå½“è·¯ç”±è·³è½¬æ—¶æ˜¯ä¸ä¼šé‡æ–°è·å–é™æ€æ–‡ä»¶åœ°å€åˆ—è¡¨ï¼Œè¿™æ—¶é¡µé¢å¯èƒ½ä¼šå› ä¸ºæ‰¾ä¸åˆ°æ–‡ä»¶è€Œæ— æ³•ç»§ç»­ä½¿ç”¨ï¼Œç”¨æˆ·åªèƒ½é€šè¿‡åˆ·æ–°é¡µé¢æ¥è§£å†³ã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"linkæ ‡ç­¾çš„prefetchå’Œpreloadæ¨¡å¼\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åœ¨åŸç”Ÿhtmlæ–‡ä»¶ä¸­ï¼Œlinkæ ‡ç­¾ç”¨äºåŠ è½½å¤–éƒ¨èµ„æºï¼Œç†è§£linkæ ‡ç­¾å¯¹èµ„æºåŠ è½½æ—¶æœºçš„è®¾è®¡ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£è·¯ç”±é¢„åŠ è½½ç­–ç•¥çš„è®¾è®¡æ€è·¯ã€‚åœ¨ä½¿ç”¨linkæ ‡ç­¾æ¥åŠ è½½æ–‡ä»¶æ—¶ï¼Œrelå‚æ•°çš„\", _jsx(_components.code, {\n        children: \"prefetch\"\n      }), \"å’Œ\", _jsx(_components.code, {\n        children: \"preload\"\n      }), \"æ¨¡å¼éƒ½æ˜¯å’Œæ‡’åŠ è½½ç›¸å…³çš„å‚æ•°ï¼Œä»–ä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"prefetch: ç”¨äºé¢„è·å–ä¸‹ä¸€ä¸ªé¡µé¢éœ€è¦çš„æ–‡ä»¶ï¼Œè¯·æ±‚çš„ä¼˜å…ˆçº§ä¸€èˆ¬ä¸ºLowest\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"preload: ç”¨äºåŠ è½½å½“å‰é¡µé¢å¾ˆå¿«å°±éœ€è¦çš„æ–‡ä»¶ï¼Œåœ¨é¡µé¢ç”Ÿå‘½å‘¨æœŸå¼€å§‹ä¹‹å‰å°±ä¼šè§¦å‘è¯·æ±‚ï¼Œå½“åŠ è½½jsæ–‡ä»¶æ—¶ï¼Œè¯·æ±‚ä¼˜å…ˆçº§ä¸ºHighï¼ŒåŠ è½½cssæ–‡ä»¶æ—¶ä¼˜å…ˆçº§ä¸ºHighest\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"ReactRouter\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"æ²¡æœ‰å¯¹é¢„åŠ è½½çš„å®ç°ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªå®šä¹‰\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"2\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Nextjs\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åœ¨Linkç»„ä»¶ä¸Šé€šè¿‡\", _jsx(_components.code, {\n        children: \"prefetch\"\n      }), \"ä¼ å‚æ¥å®šä¹‰æ˜¯å¦å¼€å¯é¢„åŠ è½½ï¼Œè®¾ç½®ä¸º\", _jsx(_components.code, {\n        children: \"true\"\n      }), \"æ—¶ï¼Œå½“linkç»„ä»¶æ¸²æŸ“åœ¨å¯è§†èŒƒå›´å†…ï¼Œå¼€å§‹é¢„åŠ è½½ç›¸å…³æ–‡ä»¶ï¼Œè¿™ç§é¢„åŠ è½½æ¨¡å¼æ¯”è¾ƒæ¥è¿‘åŸç”Ÿ\", _jsx(\"link\", {}), \"çš„prefetchæ¨¡å¼ã€‚\"]\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"3\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"TanStack Router\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"å¯å…¨å±€è®¾ç½®é»˜è®¤é¢„åŠ è½½ç­–ç•¥ï¼Œä¹Ÿå¯åŸºäºLinkä¸ªæ€§åŒ–\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [\"ç›®å‰å·²æä¾›äº†ä¸¤ç§é¢„åŠ è½½ç­–ç•¥ï¼š\", _jsx(_components.code, {\n            children: \"intent\"\n          }), \"å’Œ\", _jsx(_components.code, {\n            children: \"viewport\"\n          }), \" ï¼Œå‰è€…ä¼šåœ¨hoveråˆ°\", _jsx(_components.code, {\n            children: \"Link\"\n          }), \"ç»„ä»¶æ—¶åŠ è½½ç»„ä»¶ï¼Œåè€…è·ŸNextjsçš„æ–¹æ¡ˆç›¸ä¼¼ï¼Œåœ¨\", _jsx(_components.code, {\n            children: \"Link\"\n          }), \"ç»„ä»¶è¿›å…¥è§†å›¾ä¸­åŠ è½½ç»„ä»¶\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"ä½¿ç”¨ReactRouterå¦‚ä½•è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"åŸºæœ¬æ€è·¯\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"æ‰©å±•\", _jsx(_components.code, {\n          children: \"react-router\"\n        }), \"çš„\", _jsx(_components.code, {\n          children: \"Link\"\n        }), \"ç»„ä»¶ï¼Œå¢åŠ preloadå‚æ•°ï¼Œæ”¯æŒ\", _jsx(_components.code, {\n          children: \"'intent'\"\n        }), \"å’Œ\", _jsx(_components.code, {\n          children: \"'viewport'\"\n        }), \"ä¸¤ç§ç­–ç•¥ã€‚\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"å®šä¹‰ä¸€ä¸ª\", _jsx(_components.code, {\n          children: \"lazyLoad\"\n        }), \"å‡½æ•°æ›¿æ¢\", _jsx(_components.code, {\n          children: \"React.lazy\"\n        }), \"ï¼Œè¿”å›å¯¹è±¡ä¸­å¢åŠ \", _jsx(_components.code, {\n          children: \"preload\"\n        }), \"æ–¹æ³•ï¼Œç”¨äºæ‰‹åŠ¨è°ƒç”¨ã€‚\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"åœ¨å£°æ˜routeé…ç½®æ—¶å£°æ˜Componentå‚æ•°ä¸ºï¼š\", _jsx(_components.code, {\n          children: \"lazyLoad(() =\u003e import('@src/pages/xxx'))\"\n        }), \"ã€‚\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Linkç»„ä»¶ä¸­æ ¹æ®ä¼ å…¥çš„\", _jsx(_components.code, {\n          children: \"to\"\n        }), \"æ‹¿åˆ°ç›¸åº”çš„\", _jsx(_components.code, {\n          children: \"Component\"\n        }), \"ä¹‹åå³å¯è°ƒç”¨æ­¥éª¤2å£°æ˜çš„preloadæ–¹æ³•ï¼Œå¹¶æ ¹æ®æŒ‡å®šçš„ç­–ç•¥æ¥å†³å®šè°ƒç”¨çš„æ—¶æœºã€‚\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"å…·ä½“å®ç°\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"Link\"\n      }), \"ç»„ä»¶:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-typescript\",\n        children: \"import useForkRef from '@/hooks/useForkRef';\\nimport { useIntersectionObserver } from '@/hooks/useIntersectionObserver';\\nimport type { ComponentType } from 'react';\\nimport { forwardRef, useCallback, useRef } from 'react';\\nimport type { LinkProps as RouterLinkProps } from 'react-router-dom';\\nimport { Link as RouterLink, matchRoutes } from 'react-router-dom';\\nimport useRoutesData from '../RoutesProvider/useRoutesData';\\nimport type { LazyLoadResult } from '@/utils/lazy';\\n\\ninterface LinkProps extends RouterLinkProps {\\n  /** preload strategy */\\n  preload?: 'intent' | 'viewport' | false;\\n}\\n\\n/**\\n * åŸºäºreact-router-domçš„Linkç»„ä»¶å®ç°äº†preloadåŠŸèƒ½\\n */\\nconst Link = forwardRef\u003cHTMLAnchorElement, LinkProps\u003e(function Link(\\n  { preload, onMouseEnter, ...props },\\n  forwardedRef,\\n) {\\n  const preloadedComponent = useRef\u003cComponentType\u003e();\\n  const elementRef = useRef\u003cHTMLAnchorElement | null\u003e(null);\\n  const mergedRef = useForkRef(elementRef, forwardedRef);\\n\\n  // æ‹¿åˆ°æ‰€æœ‰routesé…ç½®\\n  const routes = useRoutesData();\\n\\n  // preload component\\n  const preloadComponent = useCallback(() =\u003e {\\n    if (!preloadedComponent.current) {\\n      const matches = matchRoutes(routes, props.to);\\n      matches?.forEach((route) =\u003e {\\n        const loader = (route.route.Component as LazyLoadResult)?.preload;\\n        if (loader) {\\n          loader().then((module) =\u003e {\\n            preloadedComponent.current = module.default;\\n          });\\n        }\\n      });\\n    }\\n  }, [props.to, routes]);\\n\\n  const handleMouseEnter: React.MouseEventHandler\u003cHTMLAnchorElement\u003e = useCallback(\\n    (e) =\u003e {\\n      if (preload === 'intent') {\\n        preloadComponent();\\n      }\\n      onMouseEnter?.(e);\\n    },\\n    [preloadComponent, onMouseEnter, preload],\\n  );\\n\\n  const preloadViewportIoCallback = useCallback(\\n    (entry: IntersectionObserverEntry | undefined) =\u003e {\\n      if (entry?.isIntersecting) {\\n        preloadComponent();\\n      }\\n    },\\n    [preloadComponent],\\n  );\\n\\n  useIntersectionObserver\u003cHTMLAnchorElement\u003e(\\n    elementRef,\\n    preloadViewportIoCallback,\\n    {},\\n    { disabled: preload !== 'viewport' },\\n  );\\n\\n  return \u003cRouterLink ref={mergedRef} {...props} onMouseEnter={handleMouseEnter} /\u003e;\\n});\\n\\nexport default Link;\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"lazyLoad\"\n      }), \"å‡½æ•°ï¼š\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-typescript\",\n        children: \"import type { ComponentType, LazyExoticComponent } from 'react';\\nimport { lazy } from 'react';\\n\\nexport type LazyLoadResult\u003cT extends ComponentType\u003cany\u003e = ComponentType\u003cany\u003e\u003e =\\n  LazyExoticComponent\u003cT\u003e \u0026 {\\n    preload: () =\u003e Promise\u003c{ default: T }\u003e;\\n  };\\n\\nexport function lazyLoad\u003cT extends ComponentType\u003cany\u003e\u003e(\\n  load: () =\u003e Promise\u003c{ default: T }\u003e,\\n): LazyLoadResult\u003cT\u003e {\\n  let preloaded = false;\\n  let loadedComponent: { default: T };\\n  const loadComponent = async () =\u003e {\\n    if (preloaded) return loadedComponent;\\n    loadedComponent = await load().then((res) =\u003e {\\n      preloaded = true;\\n      return res;\\n    });\\n    return loadedComponent;\\n  };\\n  const preload = loadComponent;\\n  const lazyComponent: any = lazy(loadComponent);\\n  lazyComponent.preload = preload;\\n\\n  return lazyComponent as LazyLoadResult\u003cT\u003e;\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"routes\"\n      }), \"æ–‡ä»¶:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-typescript\",\n        children: \"import Loading from '@/components/Loading';\\nimport Layout from '@/components/layouts';\\nimport { lazyLoad } from '@/utils/lazy';\\nimport type { RouteObject } from 'react-router-dom';\\nimport { Navigate } from 'react-router-dom';\\n\\nconst Home = lazyLoad(() =\u003e import('@/pages/Home'));\\nconst routes: RouteObject[] = [\\n  {\\n    path: '/',\\n    element: \u003cLayout /\u003e,\\n    children: [\\n      {\\n        index: true,\\n        element: \u003cNavigate to=\\\"/home\\\" /\u003e,\\n      },\\n      {\\n        path: 'home',\\n        Component: Home,\\n      },\\n    ],\\n  },\\n];\\n\\nexport default routes;\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"å…·ä½“ä»£ç å®ç°å¯å‚è€ƒæ¨¡æ¿é¡¹ç›®ï¼š\", _jsx(_components.a, {\n        href: \"https://github.com/hmilin/react-vite-template\",\n        children: \"hmilin/react-vite-template\"\n      })]\n    }), \"\\n\", _jsxs(_components.h2, {\n      children: [\"ä¸ºä»€ä¹ˆæ’ä»¶\", _jsx(_components.code, {\n        children: \"vite-plugin-preload\"\n      }), \"å¯¹åŠ è½½æ€§èƒ½æå‡æ— æ•ˆ\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åœ¨\", _jsx(_components.code, {\n        children: \"vite+react\"\n      }), \"é¡¹ç›®ä¸­è§£å†³é¢„åŠ è½½é—®é¢˜æ—¶ï¼Œçœ‹åˆ°æ’ä»¶\", _jsx(_components.code, {\n        children: \"vite-plugin-preload\"\n      }), \"ï¼Œä½†æ˜¯çœ‹äº†ä»–çš„å…·ä½“å®ç°æ–¹å¼å‘ç°å¹¶ä¸èƒ½è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚åŸå› æ˜¯ï¼šä½¿ç”¨\", _jsx(_components.code, {\n        children: \"vite-plugin-preload\"\n      }), \"æ’ä»¶åï¼Œæ‰€æœ‰åŸå…ˆåŠ¨æ€åŠ è½½çš„æ¨¡å—éƒ½ä¼šä½¿ç”¨\", _jsx(_components.code, {\n        children: \"\u003clink rel=\\\"modulepreload\\\" href=\\\"xxx.js\\\" /\u003e\"\n      }), \"åŠ åˆ°å…¥å£htmlæ–‡ä»¶ä¸­ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶ï¼Œå°†åœ¨ç¬¬ä¸€æ—¶é—´åŠ è½½æ‰€æœ‰æ¨¡å—æ–‡ä»¶ï¼Œä¸”è¯·æ±‚ä¼˜å…ˆçº§ä¸ºHighã€‚å½“é¡¹ç›®æ¯”è¾ƒåºå¤§æ—¶ï¼Œé¦–å±åŠ è½½æ—¶é—´å°†ä¼šå˜å¾—å¾ˆå¤§ã€‚\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{"title":"Reactä¸­çš„é¢„åŠ è½½ç­–ç•¥","description":"Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”ï¼Œä»¥åŠåœ¨ä½¿ç”¨react-routeræ—¶å¦‚ä½•è¿›è¡Œé¢„åŠ è½½è®¾ç½®","public":true,"date":"2024-08-26 10:13:00","category":"performance"}},"frontMatter":{"title":"Reactä¸­çš„é¢„åŠ è½½ç­–ç•¥","description":"Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”ï¼Œä»¥åŠåœ¨ä½¿ç”¨react-routeræ—¶å¦‚ä½•è¿›è¡Œé¢„åŠ è½½è®¾ç½®","public":true,"date":"2024-08-26 10:13:00","category":"performance"},"headings":[{"depth":2,"text":"linkæ ‡ç­¾çš„prefetchå’Œpreloadæ¨¡å¼"},{"depth":2,"text":"Reactè·¯ç”±æ¡†æ¶çš„é¢„åŠ è½½ç­–ç•¥å¯¹æ¯”"},{"depth":2,"text":"ä½¿ç”¨ReactRouterå¦‚ä½•è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥"},{"depth":3,"text":"åŸºæœ¬æ€è·¯"},{"depth":3,"text":"å…·ä½“å®ç°"},{"depth":2,"text":"ä¸ºä»€ä¹ˆæ’ä»¶å¯¹åŠ è½½æ€§èƒ½æå‡æ— æ•ˆ"}]},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"react-router-preload"},"buildId":"OKE3GmY2jrZso7TnNn3Ue","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>