<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>蛋黄派碎冰冰</title><meta name="description" content="蛋黄派碎冰冰的博客"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/e0545ffc3f78babf.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e0545ffc3f78babf.css" data-n-g=""/><link rel="preload" href="/_next/static/css/4a0c5542377ce400.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4a0c5542377ce400.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-fdc1f1e72b3c0540.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-e267bb9839e5051c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fe85ddc63867fc19.js" defer=""></script><script src="/_next/static/chunks/347-34557e8e6f4e11a0.js" defer=""></script><script src="/_next/static/chunks/384-64a86c1d997b1133.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-f44b08a790a851f8.js" defer=""></script><script src="/_next/static/eQHzwepfXML6lMuZMdrtB/_buildManifest.js" defer=""></script><script src="/_next/static/eQHzwepfXML6lMuZMdrtB/_ssgManifest.js" defer=""></script><script src="/_next/static/eQHzwepfXML6lMuZMdrtB/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="Layout_container__CSAqU"><header class="Header_header__Z4YN5"><a href="/">蛋黄派碎冰冰</a><nav><ul><li><a href="/#posts">文章</a></li><li><a href="/about">关于</a></li></ul></nav></header><main><div class="Layout_banner__0qsJd"><h1>动态表单库 Formly</h1><p>介绍在Angular中如何使用Formly让动态表单实现更简洁。</p><div>2021-09-22 21:00:00</div></div><div class="content-container"><h1>动态表单库 Formly</h1>
<p>在一些偏中后台的项目中，表单功能是很常见的业务。随着各个框架和组件库对表单的功能扩展，写表单变得越来越简单，功能也越来越丰富。但是在一些复杂的业务场景中，处理复杂表单还是要耗费很多时间，并且很难分离业务逻辑和视图处理的代码。于是有很多动态表单生成库出现了，Angular 的 Formly，React 的 react-hook-form，同时支持 Vue 和 React 的 Formily，都是解决复杂表单的方案。</p>
<p>Formly 就是 Angular 生态中被使用最多的动态表单库，具有很高的可维护性。并且 Formly 是基于 Angular 的响应式表单开发的，只要你掌握了响应式表单的内容，就可以很快上手 Formly。</p>
<h2>Formly 支持功能</h2>
<ul>
<li>自动生成表格</li>
<li>支持使用自定义字段类型、验证器、包装器和扩展</li>
<li>支持多种模式（正式模式和 JSON 模式）</li>
<li>支持多个常用组件库</li>
<li>基于 Angular 响应式表单</li>
</ul>
<h2>Formly 支持的组件库</h2>
<ul>
<li>Bootstrap</li>
<li>Material2</li>
<li>Ionic</li>
<li>PrimeNG</li>
<li>Kendo</li>
<li>NativeScript</li>
<li>NG-ZORRO</li>
</ul>
<h2>快速开始</h2>
<h3>安装</h3>
<p>安装 Formly 并指定使用 UI 库 Ng-Zorro</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>npx ng add @ngx-formly/schematics --ui-theme=ng-zorro-antd
</span></code></pre>
<p>执行上面命令会帮我们安装好 @ngx-formly/core、@ngx-formly/ng-zorro-antd 和 @ngx-formly/schematics，并在 AppModule 中导入，代码如下：</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>imports: [
</span>	...
<!-- -->	ReactiveFormsModule,
<span>	FormlyModule.forRoot({ </span><span class="hljs-attr">extras</span><span>: { </span><span class="hljs-attr">lazyRender</span><span>: </span><span style="color:#d08770">true</span><span> } }),
</span>	FormlyNgZorroAntdModule
<!-- -->]
</code></pre>
<h3>添加<code>&lt;formly-form&gt;</code></h3>
<p><code>formly-form</code>有三个参数</p>
<ul>
<li>fields：表单字段配置</li>
<li>form：指定表单实例用于跟踪表单状态</li>
<li>model：表单的数据模型</li>
</ul>
<p>template 代码如下：</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>&lt;form [formGroup]=</span><span style="color:#a3be8c">&quot;form&quot;</span><span>&gt;
</span><span>  </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">formly-form</span><span class="xml" style="color:#bf616a"> [</span><span class="xml hljs-attr" style="color:#bf616a">form</span><span class="xml" style="color:#bf616a">]=</span><span class="xml" style="color:#a3be8c">&quot;form&quot;</span><span class="xml" style="color:#bf616a"> [</span><span class="xml hljs-attr" style="color:#bf616a">fields</span><span class="xml" style="color:#bf616a">]=</span><span class="xml" style="color:#a3be8c">&quot;fields&quot;</span><span class="xml" style="color:#bf616a"> [</span><span class="xml hljs-attr" style="color:#bf616a">model</span><span class="xml" style="color:#bf616a">]=</span><span class="xml" style="color:#a3be8c">&quot;model&quot;</span><span class="xml" style="color:#bf616a">&gt;</span><span class="xml" style="color:#bf616a">&lt;/</span><span class="xml" style="color:#bf616a">formly-form</span><span class="xml" style="color:#bf616a">&gt;</span><span>
</span><span>  </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">button</span><span class="xml" style="color:#bf616a"> </span><span class="xml hljs-attr" style="color:#bf616a">nzType</span><span class="xml" style="color:#bf616a">=</span><span class="xml" style="color:#a3be8c">&quot;primary&quot;</span><span class="xml" style="color:#bf616a"> </span><span class="xml hljs-attr" style="color:#bf616a">nz-button</span><span class="xml" style="color:#bf616a">&gt;</span><span class="xml">保存</span><span class="xml" style="color:#bf616a">&lt;/</span><span class="xml" style="color:#bf616a">button</span><span class="xml" style="color:#bf616a">&gt;</span><span>
</span>&lt;/form&gt;
</code></pre>
<h3>添加配置数据</h3>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span> 	form = </span><span style="color:#b48ead">new</span><span> FormGroup({});
</span><span>	model = { </span><span class="hljs-attr">email</span><span>: </span><span style="color:#a3be8c">&#x27;email@gmail.com&#x27;</span><span> };
</span>	fields: FormlyFieldConfig[] = [
<!-- -->		{
<span>			</span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">&#x27;email&#x27;</span><span>,
</span><span>			</span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span>,
</span><span>			</span><span class="hljs-attr">templateOptions</span><span>: {
</span><span>				</span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;Email address&#x27;</span><span>,
</span><span>				</span><span class="hljs-attr">placeholder</span><span>: </span><span style="color:#a3be8c">&#x27;Enter email&#x27;</span><span>,
</span><span>				</span><span class="hljs-attr">required</span><span>: </span><span style="color:#d08770">true</span><span>,
</span>			}
<!-- -->		}
<!-- -->	];
</code></pre>
<p>然后就可以看到表单生成效果啦</p>
<p><img src="/posts-img/formly-quick-start.png" alt="生成效果"/></p>
<h3>配置</h3>
<ul>
<li>输入参数：</li>
</ul>
<table><thead><tr><th>名称</th><th>类型</th><th>默认值</th><th>必填</th><th>描述</th></tr></thead><tbody><tr><td>form</td><td>FormGroup 或 FormArray</td><td>new FormGroup(<!-- -->)</td><td>否</td><td>允许跟踪模型值和验证状态的表单实例</td></tr><tr><td>fields</td><td>FormlyFieldConfig[]</td><td></td><td>是</td><td>字段配置</td></tr><tr><td>model</td><td>any</td><td></td><td>是</td><td>表单的数据模型</td></tr><tr><td>options</td><td>FormlyFormOptions</td><td></td><td>否</td><td>表单选项</td></tr></tbody></table>
<ul>
<li>输出参数：</li>
</ul>
<table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>(modelChange)</td><td>字段数据发送变化</td></tr></tbody></table>
<ul>
<li>fields</li>
</ul>
<p>fields 主要是传一些跟字段显示和处理逻辑相关的参数，具体可以参考他的类型定义</p>
<ul>
<li>options</li>
</ul>
<p>options 的接口定义如下：</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>interface FormlyFormOptions {
</span><span>    updateInitialValue?: </span><span class="hljs-function">() =&gt;</span><span> </span><span style="color:#b48ead">void</span><span>;
</span><span>    resetModel?: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">model?: any</span><span class="hljs-function">) =&gt;</span><span> </span><span style="color:#b48ead">void</span><span>;
</span>    formState?: any;
<!-- -->    fieldChanges?: Subject&lt;FormlyValueChangeEvent&gt;;
<span>    fieldTransform?: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">fields: FormlyFieldConfig[], model: any, form: FormGroup | FormArray, options: FormlyFormOptions</span><span class="hljs-function">) =&gt;</span><span> FormlyFieldConfig[];
</span><span>    showError?: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">field: FieldType</span><span class="hljs-function">) =&gt;</span><span> boolean;
</span><span>    parentForm?: FormGroupDirective | </span><span style="color:#d08770">null</span><span>;
</span>}
</code></pre>
<p><code>fromState</code> 是一种用来在字段间通信的机制。</p>
<p><code>fieldTransform</code> 用于在 Formly 处理或验证 fileds 之前转换成新的 fields 配置。</p>
<h3>验证器</h3>
<p>Formly 支持全局声明自定义验证器和错误信息，使用的时候只需传入之前定义的 key 值</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">export</span><span> </span><span class="hljs-function" style="color:#b48ead">function</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#8fa1b3">IpValidator</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">control: FormControl</span><span class="hljs-function">): </span><span class="hljs-function" style="color:#8fa1b3">ValidationErrors</span><span class="hljs-function"> </span><span>{
</span><span>  </span><span style="color:#b48ead">return</span><span> </span><span style="color:#bf616a">/(\d{1,3}\.){3}\d{1,3}/</span><span>.test(control.value) ? </span><span style="color:#d08770">null</span><span> : { </span><span style="color:#a3be8c">&#x27;ip&#x27;</span><span>: </span><span style="color:#d08770">true</span><span> };
</span>}
<!-- -->...
<!-- -->@NgModule({
<span>  </span><span class="hljs-attr">imports</span><span>: [
</span>    ...
<!-- -->    FormlyModule.forRoot({
<span>      </span><span class="hljs-attr">validators</span><span>: [
</span><span>        { </span><span class="hljs-attr">name</span><span>: </span><span style="color:#a3be8c">&#x27;ip&#x27;</span><span>, </span><span class="hljs-attr">validation</span><span>: IpValidator },
</span>      ],
<span>      </span><span class="hljs-attr">validationMessages</span><span>: [
</span><span>        { </span><span class="hljs-attr">name</span><span>: </span><span style="color:#a3be8c">&#x27;ip&#x27;</span><span>, </span><span class="hljs-attr">message</span><span>: IpValidatorMessage },
</span><span>        { </span><span class="hljs-attr">name</span><span>: </span><span style="color:#a3be8c">&#x27;required&#x27;</span><span>, </span><span class="hljs-attr">message</span><span>: </span><span style="color:#a3be8c">&#x27;This field is required&#x27;</span><span> },
</span>      ],
<!-- -->    }),
<!-- -->  ]
<!-- -->})
</code></pre>
<p>使用如下：</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>{
</span><span>  </span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">&#x27;ip&#x27;</span><span>,
</span><span>  </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span>,
</span><span>  </span><span class="hljs-attr">templateOptions</span><span>: {
</span><span>    </span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;IP Address (using custom validation declared in ngModule)&#x27;</span><span>,
</span><span>    </span><span class="hljs-attr">required</span><span>: </span><span style="color:#d08770">true</span><span>,
</span>  },
<span>  </span><span class="hljs-attr">validators</span><span>: {
</span><span>    </span><span class="hljs-attr">validation</span><span>: [</span><span style="color:#a3be8c">&#x27;ip&#x27;</span><span>],
</span>  },
<!-- -->},
</code></pre>
<p>也可以在定义 field 值的时候引入自定义验证器，使用如下：</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>{
</span><span>  </span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">&#x27;ip&#x27;</span><span>,
</span><span>  </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span>,
</span><span>  </span><span class="hljs-attr">templateOptions</span><span>: {
</span><span>    </span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;IP Address (using custom validation through `validators.validation` property)&#x27;</span><span>,
</span><span>    </span><span class="hljs-attr">required</span><span>: </span><span style="color:#d08770">true</span><span>,
</span>  },
<span>  </span><span class="hljs-attr">validators</span><span>: {
</span><span>    </span><span class="hljs-attr">validation</span><span>: [IpValidator],
</span>  },
<span>	</span><span class="hljs-attr">asyncValidators</span><span>: {
</span><span>    </span><span class="hljs-attr">validation</span><span>: [IpAsyncValidator],
</span>	}
<!-- -->},
</code></pre>
<p>field 中的 validators 的值也可以是表达式的形势</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>NAME_OF_VALIDATOR: {
</span><span>  </span><span class="hljs-attr">expression</span><span>: FUNCTION
</span><span>  </span><span class="hljs-attr">message</span><span>: FUNCTION | STRING
</span>}
</code></pre>
<p>示例如下：</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span> validators: {
</span><span>    </span><span class="hljs-attr">ip</span><span>: {
</span><span>      </span><span class="hljs-attr">expression</span><span>: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">c</span><span class="hljs-function">) =&gt;</span><span> </span><span style="color:#bf616a">/(\d{1,3}\.){3}\d{1,3}/</span><span>.test(c.value),
</span><span>      </span><span class="hljs-attr">message</span><span>: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">error, field: FormlyFieldConfig</span><span class="hljs-function">) =&gt;</span><span> </span><span style="color:#a3be8c">`&quot;</span><span class="hljs-subst" style="color:#a3be8c">${field.formControl.value}</span><span style="color:#a3be8c">&quot; is not a valid IP Address`</span><span>,
</span>    },
<!-- -->  },
</code></pre>
<p>当然也可以是异步的，返回一个 promise 对象即可，示例如下：</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span> asyncValidators: {
</span><span>    </span><span class="hljs-attr">ip</span><span>: {
</span><span>      </span><span class="hljs-attr">expression</span><span>: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">c</span><span class="hljs-function">) =&gt;</span><span> </span><span style="color:#b48ead">return</span><span> </span><span style="color:#b48ead">new</span><span> </span><span style="color:#d08770">Promise</span><span>(</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">resolve, reject</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>        </span><span style="color:#d08770">setTimeout</span><span>(</span><span class="hljs-function">() =&gt;</span><span> {
</span><span>          resolve(</span><span style="color:#bf616a">/(\d{1,3}\.){3}\d{1,3}/</span><span>.test(c.value));
</span><span>        }, </span><span style="color:#d08770">1000</span><span>);
</span>      }),
<span>      </span><span class="hljs-attr">message</span><span>: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">error, field: FormlyFieldConfig</span><span class="hljs-function">) =&gt;</span><span> </span><span style="color:#a3be8c">`&quot;</span><span class="hljs-subst" style="color:#a3be8c">${field.formControl.value}</span><span style="color:#a3be8c">&quot; is not a valid IP Address`</span><span>,
</span>    },
<!-- -->  }
</code></pre>
<h3>Formly 表达式</h3>
<p>Formly 定义了一种表达式格式，用于动态修改 field 值。主要通过<code>hideExpression</code>和<code>expressionProperties</code>两个字段来定义。</p>
<ol>
<li><code>hideExpression</code>用于动态显示表单字段</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>{
</span><span>  </span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">&#x27;iLikeTwix&#x27;</span><span>,
</span><span>  </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;checkbox&#x27;</span><span>,
</span><span>  </span><span class="hljs-attr">templateOptions</span><span>: {
</span><span>    </span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;I like twix&#x27;</span><span>,
</span>  },
<span>  </span><span class="hljs-attr">hideExpression</span><span>: </span><span style="color:#a3be8c">&#x27;!model.name&#x27;</span><span>,
</span><span>	</span><span style="color:#65737e">// 也可以传入一个函数</span><span>
</span><span>	</span><span class="hljs-attr">hideExpression</span><span>: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">model: any, formState: any, field: FormlyFieldConfig</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>    </span><span style="color:#65737e">// access to the main model can be through `this.model` or `formState` or `model</span><span>
</span><span>    </span><span style="color:#b48ead">if</span><span> (formState.mainModel &amp;&amp; formState.mainModel.city) {
</span><span>      </span><span style="color:#b48ead">return</span><span> formState.mainModel.city !== </span><span style="color:#a3be8c">&quot;123&quot;</span><span>
</span>    }
<span>    </span><span style="color:#b48ead">return</span><span> </span><span style="color:#d08770">true</span><span>;
</span>  },
<!-- -->}
</code></pre>
<ol start="2">
<li><code>expressionProperties</code>用于动态修改 field 中的属性</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>{
</span><span>  </span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">&#x27;text2&#x27;</span><span>,
</span><span>  </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span>,
</span><span>  </span><span class="hljs-attr">templateOptions</span><span>: {
</span><span>    </span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;Hey!&#x27;</span><span>,
</span><span>    </span><span class="hljs-attr">placeholder</span><span>: </span><span style="color:#a3be8c">&#x27;This one is disabled if there is no text in the other input&#x27;</span><span>,
</span>  },
<span>  </span><span class="hljs-attr">expressionProperties</span><span>: {
</span><span>    </span><span style="color:#a3be8c">&#x27;templateOptions.disabled&#x27;</span><span>: </span><span style="color:#a3be8c">&#x27;!model.text&#x27;</span><span>,
</span>  },
<span>	</span><span style="color:#65737e">// 也可以传入一个函数</span><span>
</span><span>	</span><span class="hljs-attr">expressionProperties</span><span>: {
</span><span>		</span><span style="color:#a3be8c">&#x27;templateOptions.disabled&#x27;</span><span>: </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">model: any, formState: any, field: FormlyFieldConfig</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>			</span><span style="color:#65737e">// access to the main model can be through `this.model` or `formState` or `model</span><span>
</span><span>			</span><span style="color:#b48ead">return</span><span> !formState.mainModel.text
</span>		},
<!-- -->  }
<!-- -->},
</code></pre>
<h3>自定义模板</h3>
<p>除了使用已支持的 UI 库，也可以自定义组件，步骤如下：</p>
<ol>
<li>定义一个 component，继承自类<code>FieldType</code></li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">import</span><span> { Component } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@angular/core&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { FieldType } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@ngx-formly/core&#x27;</span><span>;
</span>
<!-- -->@Component({
<span> </span><span class="hljs-attr">selector</span><span>: </span><span style="color:#a3be8c">&#x27;formly-field-input&#x27;</span><span>,
</span><span> </span><span class="hljs-attr">template</span><span>: </span><span style="color:#a3be8c">`
</span><span style="color:#a3be8c">   &lt;input type=&quot;input&quot; [formControl]=&quot;formControl&quot; [formlyAttributes]=&quot;field&quot;&gt;
</span><span style="color:#a3be8c"> `</span><span>,
</span>})
<span></span><span style="color:#b48ead">export</span><span> </span><span class="hljs-class" style="color:#b48ead">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#8fa1b3">FormlyFieldInput</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#b48ead">extends</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#8fa1b3">FieldType</span><span class="hljs-class"> </span><span>{}
</span></code></pre>
<ol start="2">
<li>在 NgModule 装饰器中注册自定义类型</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">import</span><span> { FormlyFieldInput } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;./formly-field-input&#x27;</span><span>;
</span>
<!-- -->@NgModule({
<span> </span><span class="hljs-attr">declarations</span><span>: [FormlyFieldInput],
</span><span> </span><span class="hljs-attr">imports</span><span>: [
</span>   ....
<!-- -->   FormlyModule.forRoot({
<span>     </span><span class="hljs-attr">types</span><span>: [
</span><span>       { </span><span class="hljs-attr">name</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span>, </span><span class="hljs-attr">component</span><span>: FormlyFieldInput },
</span>     ],
<!-- -->   }),
<!-- --> ],
<!-- -->})
<span></span><span style="color:#b48ead">export</span><span> </span><span class="hljs-class" style="color:#b48ead">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#8fa1b3">AppModule</span><span class="hljs-class"> </span><span>{}
</span></code></pre>
<ol start="3">
<li>在 fields 中使用</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">export</span><span> </span><span class="hljs-class" style="color:#b48ead">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#8fa1b3">AppComponent</span><span class="hljs-class"> </span><span>{
</span><span> </span><span class="hljs-attr">fields</span><span>: FormlyFieldConfig[] = [
</span>   {
<span>     </span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">&#x27;firstname&#x27;</span><span>,
</span><span>     </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span>,
</span>   },
<!-- --> ];
<!-- -->
<!-- --> ...
<!-- -->}
</code></pre>
<h3>自定义 Wrapper</h3>
<p><code>wrapper</code>是用于指定一个 component 来包装字段，使用不同的 template 会预设不同的 warpper，可以使用自定义 warpper 进行覆盖</p>
<ol>
<li>定义一个继承自类 FieldWrapper 的组件</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">import</span><span> { Component, ViewChild, ViewContainerRef } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@angular/core&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { FieldWrapper } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@ngx-formly/core&#x27;</span><span>;
</span>
<!-- -->@Component({
<span></span><span class="hljs-attr">selector</span><span>: </span><span style="color:#a3be8c">&#x27;formly-wrapper-panel&#x27;</span><span>,
</span><span></span><span class="hljs-attr">template</span><span>: </span><span style="color:#a3be8c">`
</span><span style="color:#a3be8c"> &lt;div class=&quot;card&quot;&gt;
</span><span style="color:#a3be8c">   &lt;h3 class=&quot;card-header&quot;&gt;Its time to party&lt;/h3&gt;
</span><span style="color:#a3be8c">   &lt;h3 class=&quot;card-header&quot;&gt;{{ to.label }}&lt;/h3&gt;
</span><span style="color:#a3be8c">   &lt;div class=&quot;card-body&quot;&gt;
</span><span style="color:#a3be8c">     &lt;ng-container #fieldComponent&gt;&lt;/ng-container&gt;
</span><span style="color:#a3be8c">   &lt;/div&gt;
</span><span style="color:#a3be8c"> &lt;/div&gt;
</span><span style="color:#a3be8c">`</span><span>,
</span>})
<span></span><span style="color:#b48ead">export</span><span> </span><span class="hljs-class" style="color:#b48ead">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#8fa1b3">PanelWrapperComponent</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#b48ead">extends</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#8fa1b3">FieldWrapper</span><span class="hljs-class"> </span><span>{
</span>}
</code></pre>
<ol start="2">
<li>在 NgModule 装饰器中注册</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">import</span><span> { NgModule } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@angular/core&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { CommonModule } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@angular/common&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { ReactiveFormsModule } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@angular/forms&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { FormlyModule } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@ngx-formly/core&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { FormlyBootstrapModule } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;@ngx-formly/bootstrap&#x27;</span><span>;
</span>
<span></span><span style="color:#b48ead">import</span><span> { PanelWrapperComponent } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;./panel-wrapper.component&#x27;</span><span>;
</span><span></span><span style="color:#b48ead">import</span><span> { AppComponent } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&#x27;./app.component&#x27;</span><span>;
</span>
<!-- -->@NgModule({
<span></span><span class="hljs-attr">imports</span><span>: [
</span> CommonModule,
<!-- --> ReactiveFormsModule,
<!-- --> FormlyBootstrapModule,
<!-- --> FormlyModule.forRoot({
<span>   </span><span class="hljs-attr">wrappers</span><span>: [
</span><span>     { </span><span class="hljs-attr">name</span><span>: </span><span style="color:#a3be8c">&#x27;panel&#x27;</span><span>, </span><span class="hljs-attr">component</span><span>: PanelWrapperComponent },
</span>   ],
<!-- --> }),
<!-- -->],
<span></span><span class="hljs-attr">declarations</span><span>: [
</span> AppComponent,
<!-- --> PanelWrapperComponent,
<!-- -->],
<!-- -->})
<span></span><span style="color:#b48ead">export</span><span> </span><span class="hljs-class" style="color:#b48ead">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#8fa1b3">AppModule</span><span class="hljs-class"> </span><span>{ }
</span></code></pre>
<ol start="3">
<li>在定义 fields 时使用</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>fields: FormlyFieldConfig[] = [
</span>{
<span> </span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">&#x27;address&#x27;</span><span>,
</span><span> </span><span class="hljs-attr">wrappers</span><span>: [</span><span style="color:#a3be8c">&#x27;panel&#x27;</span><span>],
</span><span> </span><span class="hljs-attr">templateOptions</span><span>: { </span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;Address&#x27;</span><span> },
</span><span> </span><span class="hljs-attr">fieldGroup</span><span>: [{
</span><span>   </span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">&#x27;town&#x27;</span><span>,
</span><span>   </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span>,
</span><span>   </span><span class="hljs-attr">templateOptions</span><span>: {
</span><span>     </span><span class="hljs-attr">required</span><span>: </span><span style="color:#d08770">true</span><span>,
</span><span>     </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;text&#x27;</span><span>,
</span><span>     </span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;Town&#x27;</span><span>,
</span>   },
<!-- --> }],
<!-- -->},
<!-- -->];
</code></pre>
<p>也可以为特定的组件指定 wrapper</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>... </span><span style="color:#65737e">//Imports</span><span>
</span>  @NgModule({
<span>    </span><span class="hljs-attr">imports</span><span>: [
</span>      CommonModule,
<!-- -->      ReactiveFormsModule,
<!-- -->      FormlyBootstrapModule,
<!-- -->      FormlyModule.forRoot({
<span>        </span><span class="hljs-attr">types</span><span>: [
</span>          {
<span>            </span><span class="hljs-attr">name</span><span>: </span><span style="color:#a3be8c">&#x27;operator&#x27;</span><span>,
</span><span>            </span><span class="hljs-attr">component</span><span>: OperatorComponent,
</span><span>            </span><span class="hljs-attr">wrappers</span><span>: [</span><span style="color:#a3be8c">&#x27;form-field&#x27;</span><span>]
</span>          },
<!-- -->        ],
<!-- -->      }),
<!-- -->    ],
<span>    </span><span class="hljs-attr">declarations</span><span>: [
</span>      AppComponent,
<!-- -->      OperatorComponent
<!-- -->    ],
<!-- -->  })
<span>  </span><span style="color:#b48ead">export</span><span> </span><span class="hljs-class" style="color:#b48ead">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#8fa1b3">AppModule</span><span class="hljs-class"> </span><span>{ }
</span></code></pre>
<h3>使用 Formly 实现一个的动态表单</h3>
<p>业务需求：实现一个输入表单，需要的输入参数信息由接口提供，输入个数不定，需要的参数有三种类型，分别为 string、volume、domain，string 类型用输入框填入，volume 类型用选择器填，domain 类型需要填入子域名并选择根域名。</p>
<ol>
<li>接口返回的数据格式</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#b48ead">let</span><span> inputs: BpInputs = [
</span>      {
<span>        </span><span class="hljs-attr">bpId</span><span>: </span><span style="color:#a3be8c">&#x27;07d46205-1c59-11ec-b603-0242ac130003&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">description</span><span>: </span><span style="color:#a3be8c">&#x27;请输入cloudname&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;string&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">internal</span><span>: </span><span style="color:#d08770">false</span><span>,
</span><span>        </span><span class="hljs-attr">protocol</span><span>: </span><span style="color:#d08770">null</span><span>,
</span><span>        </span><span class="hljs-attr">port</span><span>: </span><span style="color:#d08770">0</span><span>,
</span><span>        </span><span class="hljs-attr">required</span><span>: </span><span style="color:#d08770">true</span><span>,
</span><span>        </span><span class="hljs-attr">initValue</span><span>: {},
</span><span>        </span><span class="hljs-attr">hidden</span><span>: </span><span style="color:#d08770">false</span><span>,
</span><span>        </span><span class="hljs-attr">path</span><span>: </span><span style="color:#a3be8c">&#x27;.bp&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">keyData</span><span>: </span><span style="color:#a3be8c">&#x27;bp_cloudname&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">valueData</span><span>: </span><span style="color:#d08770">null</span><span>,
</span><span>        </span><span class="hljs-attr">labelData</span><span>: </span><span style="color:#a3be8c">&#x27;image-497f&gt;cloudname&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">default</span><span>: </span><span style="color:#d08770">null</span><span>,
</span>      },
<!-- -->      {
<span>        </span><span class="hljs-attr">bpId</span><span>: </span><span style="color:#a3be8c">&#x27;07d46205-1c59-11ec-b603-0242ac130003&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">description</span><span>: </span><span style="color:#a3be8c">&#x27;80端口服务的子域名&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;domain&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">internal</span><span>: </span><span style="color:#d08770">false</span><span>,
</span><span>        </span><span class="hljs-attr">protocol</span><span>: </span><span style="color:#a3be8c">&#x27;HTTP&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">port</span><span>: </span><span style="color:#d08770">80</span><span>,
</span><span>        </span><span class="hljs-attr">required</span><span>: </span><span style="color:#d08770">true</span><span>,
</span><span>        </span><span class="hljs-attr">initValue</span><span>: {},
</span><span>        </span><span class="hljs-attr">hidden</span><span>: </span><span style="color:#d08770">false</span><span>,
</span><span>        </span><span class="hljs-attr">path</span><span>: </span><span style="color:#a3be8c">&#x27;.bp&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">keyData</span><span>: </span><span style="color:#a3be8c">&#x27;bp_domain80&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">valueData</span><span>: </span><span style="color:#d08770">null</span><span>,
</span><span>        </span><span class="hljs-attr">labelData</span><span>: </span><span style="color:#a3be8c">&#x27;image-497f&gt;80端口访问域名&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">default</span><span>: </span><span style="color:#d08770">null</span><span>,
</span>      },
<!-- -->      {
<span>        </span><span class="hljs-attr">bpId</span><span>: </span><span style="color:#a3be8c">&#x27;07d46205-1c59-11ec-b603-0242ac130003&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">description</span><span>: </span><span style="color:#a3be8c">&#x27;存储路径&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;volume&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">internal</span><span>: </span><span style="color:#d08770">false</span><span>,
</span><span>        </span><span class="hljs-attr">protocol</span><span>: </span><span style="color:#d08770">null</span><span>,
</span><span>        </span><span class="hljs-attr">port</span><span>: </span><span style="color:#d08770">0</span><span>,
</span><span>        </span><span class="hljs-attr">required</span><span>: </span><span style="color:#d08770">true</span><span>,
</span><span>        </span><span class="hljs-attr">initValue</span><span>: { </span><span class="hljs-attr">path</span><span>: </span><span style="color:#a3be8c">&#x27;/var/lib/nginx&#x27;</span><span> },
</span><span>        </span><span class="hljs-attr">hidden</span><span>: </span><span style="color:#d08770">false</span><span>,
</span><span>        </span><span class="hljs-attr">path</span><span>: </span><span style="color:#a3be8c">&#x27;.bp&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">keyData</span><span>: </span><span style="color:#a3be8c">&#x27;bp_volume_var_lib_nginx&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">valueData</span><span>: </span><span style="color:#d08770">null</span><span>,
</span><span>        </span><span class="hljs-attr">labelData</span><span>: </span><span style="color:#a3be8c">&#x27;image-497f&gt;存储路径&#x27;</span><span>,
</span><span>        </span><span class="hljs-attr">default</span><span>: </span><span style="color:#d08770">null</span><span>,
</span>      },
<!-- -->    ];
</code></pre>
<ol start="2">
<li>获取接口数据并定义 fields 值</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>	form = </span><span style="color:#b48ead">new</span><span> FormGroup({});
</span>	model = {};
<!-- -->	fields: FormlyFieldConfig[] = [];
<!-- -->	options: FormlyFormOptions;
<span>	volumeOptions = [{ </span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;aaa&#x27;</span><span>, </span><span class="hljs-attr">value</span><span>: </span><span style="color:#a3be8c">&#x27;aaa&#x27;</span><span> }];
</span><span>	domainSuffix = [{ </span><span class="hljs-attr">label</span><span>: </span><span style="color:#a3be8c">&#x27;dev.xxx.cn&#x27;</span><span>, </span><span class="hljs-attr">value</span><span>: </span><span style="color:#a3be8c">&#x27;dev.xxx.cn&#x27;</span><span> }];
</span>
<span>	</span><span class="hljs-function" style="color:#8fa1b3">constructor</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">private formlyService: FormlyService</span><span class="hljs-function">)</span><span> {}
</span>
<span>	ngOnInit(): </span><span style="color:#b48ead">void</span><span> {
</span><span>		</span><span style="color:#d08770">this</span><span>.formlyService.getInputs().subscribe(</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">res</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>			</span><span style="color:#d08770">this</span><span>.initFields(res);
</span>		});
<!-- -->	}
<!-- -->
<span>	</span><span class="hljs-function" style="color:#8fa1b3">initFields</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#d08770">inputs: BpInputs</span><span class="hljs-function">)</span><span> {
</span><span>		</span><span style="color:#d08770">this</span><span>.fields = inputs.map((input): </span><span class="hljs-function" style="color:#d08770">FormlyFieldConfig</span><span class="hljs-function"> =&gt;</span><span> {
</span><span>			</span><span style="color:#b48ead">const</span><span> { </span><span class="hljs-attr">keyData</span><span>: key, labelData, type, hidden, required } = input;
</span>
<span>			</span><span style="color:#b48ead">let</span><span> field = {
</span>				key,
<span>				</span><span class="hljs-attr">name</span><span>: key,
</span><span>				</span><span class="hljs-attr">hide</span><span>: hidden,
</span><span>				</span><span class="hljs-attr">templateOptions</span><span>: {
</span>					required,
<span>					</span><span class="hljs-attr">label</span><span>: labelData,
</span>				},
<!-- -->			};
<!-- -->
<span>			</span><span style="color:#b48ead">switch</span><span> (type) {
</span><span>				</span><span style="color:#b48ead">case</span><span> </span><span style="color:#a3be8c">&#x27;string&#x27;</span><span>: {
</span><span>					</span><span style="color:#b48ead">return</span><span> { ...field, </span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span> };
</span>				}
<span>				</span><span style="color:#b48ead">case</span><span> </span><span style="color:#a3be8c">&#x27;volume&#x27;</span><span>: {
</span><span>					</span><span style="color:#b48ead">let</span><span> { templateOptions, ...oth } = field;
</span><span>					</span><span style="color:#b48ead">return</span><span> {
</span>						...oth,
<span>						</span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;select&#x27;</span><span>,
</span><span>						</span><span class="hljs-attr">templateOptions</span><span>: {
</span>							...templateOptions,
<span>							</span><span class="hljs-attr">options</span><span>: </span><span style="color:#d08770">this</span><span>.volumeOptions,
</span>						},
<!-- -->					};
<!-- -->				}
<span>				</span><span style="color:#b48ead">case</span><span> </span><span style="color:#a3be8c">&#x27;domain&#x27;</span><span>:
</span><span>					</span><span style="color:#b48ead">return</span><span> {
</span><span>						</span><span class="hljs-attr">fieldGroupClassName</span><span>: </span><span style="color:#a3be8c">&#x27;domain-group&#x27;</span><span>,
</span><span>						</span><span class="hljs-attr">fieldGroup</span><span>: [
</span>							{
<span>								</span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">`</span><span class="hljs-subst" style="color:#a3be8c">${key}</span><span style="color:#a3be8c">-prefix`</span><span>,
</span><span>								</span><span class="hljs-attr">name</span><span>: </span><span style="color:#a3be8c">`</span><span class="hljs-subst" style="color:#a3be8c">${key}</span><span style="color:#a3be8c">-prefix`</span><span>,
</span><span>								</span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;input&#x27;</span><span>,
</span><span>								</span><span class="hljs-attr">className</span><span>: </span><span style="color:#a3be8c">&#x27;flex-2&#x27;</span><span>,
</span><span>								</span><span class="hljs-attr">templateOptions</span><span>: {
</span>									required,
<span>									</span><span class="hljs-attr">label</span><span>: labelData,
</span>								},
<!-- -->							},
<!-- -->							{
<span>								</span><span class="hljs-attr">key</span><span>: </span><span style="color:#a3be8c">`</span><span class="hljs-subst" style="color:#a3be8c">${key}</span><span style="color:#a3be8c">-suffix`</span><span>,
</span><span>								</span><span class="hljs-attr">name</span><span>: </span><span style="color:#a3be8c">`</span><span class="hljs-subst" style="color:#a3be8c">${key}</span><span style="color:#a3be8c">-suffix`</span><span>,
</span><span>								</span><span class="hljs-attr">type</span><span>: </span><span style="color:#a3be8c">&#x27;select&#x27;</span><span>,
</span><span>								</span><span class="hljs-attr">className</span><span>: </span><span style="color:#a3be8c">&#x27;flex-1&#x27;</span><span>,
</span><span>								</span><span class="hljs-attr">templateOptions</span><span>: {
</span>									required,
<span>									</span><span class="hljs-attr">options</span><span>: </span><span style="color:#d08770">this</span><span>.domainSuffix,
</span>								},
<!-- -->							},
<!-- -->						],
<!-- -->					};
<span>				</span><span style="color:#b48ead">default</span><span>:
</span><span>					</span><span style="color:#b48ead">return</span><span> field;
</span>			}
<!-- -->		});
<!-- -->	}
<!-- -->
<span>	</span><span class="hljs-function" style="color:#8fa1b3">submit</span><span class="hljs-function">(</span><span class="hljs-function">)</span><span> {
</span><span>		</span><span style="color:#d08770">console</span><span>.log(</span><span style="color:#a3be8c">&#x27;model&#x27;</span><span>, </span><span style="color:#d08770">this</span><span>.model);
</span>	}
</code></pre>
<ol start="3">
<li>定义使用formly-form组件</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>&lt;form [formGroup]=</span><span style="color:#a3be8c">&quot;form&quot;</span><span> (ngSubmit)=</span><span style="color:#a3be8c">&quot;submit()&quot;</span><span>&gt;
</span><span>  </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">formly-form</span><span class="xml" style="color:#bf616a"> [</span><span class="xml hljs-attr" style="color:#bf616a">form</span><span class="xml" style="color:#bf616a">]=</span><span class="xml" style="color:#a3be8c">&quot;form&quot;</span><span class="xml" style="color:#bf616a"> [</span><span class="xml hljs-attr" style="color:#bf616a">fields</span><span class="xml" style="color:#bf616a">]=</span><span class="xml" style="color:#a3be8c">&quot;fields&quot;</span><span class="xml" style="color:#bf616a"> [</span><span class="xml hljs-attr" style="color:#bf616a">model</span><span class="xml" style="color:#bf616a">]=</span><span class="xml" style="color:#a3be8c">&quot;model&quot;</span><span class="xml" style="color:#bf616a">&gt;</span><span class="xml" style="color:#bf616a">&lt;/</span><span class="xml" style="color:#bf616a">formly-form</span><span class="xml" style="color:#bf616a">&gt;</span><span>
</span><span>  </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">nz-form-item</span><span class="xml" style="color:#bf616a">&gt;</span><span class="xml">
</span><span class="xml">    </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">nz-form-control</span><span class="xml" style="color:#bf616a"> [</span><span class="xml hljs-attr" style="color:#bf616a">nzOffset</span><span class="xml" style="color:#bf616a">]=</span><span class="xml" style="color:#a3be8c">&quot;8&quot;</span><span class="xml" style="color:#bf616a">&gt;</span><span class="xml">
</span><span class="xml">      </span><span class="xml" style="color:#bf616a">&lt;</span><span class="xml" style="color:#bf616a">button</span><span class="xml" style="color:#bf616a"> </span><span class="xml hljs-attr" style="color:#bf616a">nzType</span><span class="xml" style="color:#bf616a">=</span><span class="xml" style="color:#a3be8c">&quot;primary&quot;</span><span class="xml" style="color:#bf616a"> </span><span class="xml hljs-attr" style="color:#bf616a">nz-button</span><span class="xml" style="color:#bf616a">&gt;</span><span class="xml">保存</span><span class="xml" style="color:#bf616a">&lt;/</span><span class="xml" style="color:#bf616a">button</span><span class="xml" style="color:#bf616a">&gt;</span><span class="xml">
</span><span class="xml">    </span><span class="xml" style="color:#bf616a">&lt;/</span><span class="xml" style="color:#bf616a">nz-form-control</span><span class="xml" style="color:#bf616a">&gt;</span><span class="xml">
</span><span class="xml">  </span><span class="xml" style="color:#bf616a">&lt;/</span><span class="xml" style="color:#bf616a">nz-form-item</span><span class="xml" style="color:#bf616a">&gt;</span><span>
</span>&lt;/form&gt;
</code></pre>
<ol start="4">
<li>查看显示效果：</li>
</ol>
<p><img src="/posts-img/input-form.png" alt=""/></p>
<h3>实现自定义模板</h3>
<ol>
<li>
<p>实现一个自定义表单控件</p>
</li>
<li>
<p>定义 Formly 模板</p>
</li>
<li>
<p>注册自定义模板</p>
</li>
</ol></div></main><footer class="grid place-items-center pb-4"><a href="https://github.com/hmilin" target="_blank" rel="noreferrer noopener">😘Github</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      h1: \"h1\",\n      p: \"p\",\n      h2: \"h2\",\n      ul: \"ul\",\n      li: \"li\",\n      h3: \"h3\",\n      pre: \"pre\",\n      code: \"code\",\n      img: \"img\",\n      table: \"table\",\n      thead: \"thead\",\n      tr: \"tr\",\n      th: \"th\",\n      tbody: \"tbody\",\n      td: \"td\",\n      ol: \"ol\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.h1, {\n        children: \"动态表单库 Formly\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"在一些偏中后台的项目中，表单功能是很常见的业务。随着各个框架和组件库对表单的功能扩展，写表单变得越来越简单，功能也越来越丰富。但是在一些复杂的业务场景中，处理复杂表单还是要耗费很多时间，并且很难分离业务逻辑和视图处理的代码。于是有很多动态表单生成库出现了，Angular 的 Formly，React 的 react-hook-form，同时支持 Vue 和 React 的 Formily，都是解决复杂表单的方案。\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Formly 就是 Angular 生态中被使用最多的动态表单库，具有很高的可维护性。并且 Formly 是基于 Angular 的响应式表单开发的，只要你掌握了响应式表单的内容，就可以很快上手 Formly。\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Formly 支持功能\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"自动生成表格\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"支持使用自定义字段类型、验证器、包装器和扩展\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"支持多种模式（正式模式和 JSON 模式）\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"支持多个常用组件库\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"基于 Angular 响应式表单\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Formly 支持的组件库\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"Bootstrap\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"Material2\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"Ionic\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"PrimeNG\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"Kendo\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"NativeScript\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"NG-ZORRO\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"快速开始\"\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"安装\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"安装 Formly 并指定使用 UI 库 Ng-Zorro\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"npx ng add @ngx-formly/schematics --ui-theme=ng-zorro-antd\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"执行上面命令会帮我们安装好 @ngx-formly/core、@ngx-formly/ng-zorro-antd 和 @ngx-formly/schematics，并在 AppModule 中导入，代码如下：\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"imports: [\\n\\t...\\n\\tReactiveFormsModule,\\n\\tFormlyModule.forRoot({ extras: { lazyRender: true } }),\\n\\tFormlyNgZorroAntdModule\\n]\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.h3, {\n        children: [\"添加\", _jsx(_components.code, {\n          children: \"\u003cformly-form\u003e\"\n        })]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.code, {\n          children: \"formly-form\"\n        }), \"有三个参数\"]\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"fields：表单字段配置\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"form：指定表单实例用于跟踪表单状态\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"model：表单的数据模型\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"template 代码如下：\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"\u003cform [formGroup]=\\\"form\\\"\u003e\\n  \u003cformly-form [form]=\\\"form\\\" [fields]=\\\"fields\\\" [model]=\\\"model\\\"\u003e\u003c/formly-form\u003e\\n  \u003cbutton nzType=\\\"primary\\\" nz-button\u003e保存\u003c/button\u003e\\n\u003c/form\u003e\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"添加配置数据\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \" \\tform = new FormGroup({});\\n\\tmodel = { email: 'email@gmail.com' };\\n\\tfields: FormlyFieldConfig[] = [\\n\\t\\t{\\n\\t\\t\\tkey: 'email',\\n\\t\\t\\ttype: 'input',\\n\\t\\t\\ttemplateOptions: {\\n\\t\\t\\t\\tlabel: 'Email address',\\n\\t\\t\\t\\tplaceholder: 'Enter email',\\n\\t\\t\\t\\trequired: true,\\n\\t\\t\\t}\\n\\t\\t}\\n\\t];\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"然后就可以看到表单生成效果啦\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.img, {\n          src: \"/posts-img/formly-quick-start.png\",\n          alt: \"生成效果\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"配置\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"输入参数：\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"名称\"\n            }), _jsx(_components.th, {\n              children: \"类型\"\n            }), _jsx(_components.th, {\n              children: \"默认值\"\n            }), _jsx(_components.th, {\n              children: \"必填\"\n            }), _jsx(_components.th, {\n              children: \"描述\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: \"form\"\n            }), _jsx(_components.td, {\n              children: \"FormGroup 或 FormArray\"\n            }), _jsxs(_components.td, {\n              children: [\"new FormGroup(\", \")\"]\n            }), _jsx(_components.td, {\n              children: \"否\"\n            }), _jsx(_components.td, {\n              children: \"允许跟踪模型值和验证状态的表单实例\"\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: \"fields\"\n            }), _jsx(_components.td, {\n              children: \"FormlyFieldConfig[]\"\n            }), _jsx(_components.td, {}), _jsx(_components.td, {\n              children: \"是\"\n            }), _jsx(_components.td, {\n              children: \"字段配置\"\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: \"model\"\n            }), _jsx(_components.td, {\n              children: \"any\"\n            }), _jsx(_components.td, {}), _jsx(_components.td, {\n              children: \"是\"\n            }), _jsx(_components.td, {\n              children: \"表单的数据模型\"\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: \"options\"\n            }), _jsx(_components.td, {\n              children: \"FormlyFormOptions\"\n            }), _jsx(_components.td, {}), _jsx(_components.td, {\n              children: \"否\"\n            }), _jsx(_components.td, {\n              children: \"表单选项\"\n            })]\n          })]\n        })]\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"输出参数：\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"名称\"\n            }), _jsx(_components.th, {\n              children: \"描述\"\n            })]\n          })\n        }), _jsx(_components.tbody, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: \"(modelChange)\"\n            }), _jsx(_components.td, {\n              children: \"字段数据发送变化\"\n            })]\n          })\n        })]\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"fields\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"fields 主要是传一些跟字段显示和处理逻辑相关的参数，具体可以参考他的类型定义\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"options\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"options 的接口定义如下：\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"interface FormlyFormOptions {\\n    updateInitialValue?: () =\u003e void;\\n    resetModel?: (model?: any) =\u003e void;\\n    formState?: any;\\n    fieldChanges?: Subject\u003cFormlyValueChangeEvent\u003e;\\n    fieldTransform?: (fields: FormlyFieldConfig[], model: any, form: FormGroup | FormArray, options: FormlyFormOptions) =\u003e FormlyFieldConfig[];\\n    showError?: (field: FieldType) =\u003e boolean;\\n    parentForm?: FormGroupDirective | null;\\n}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.code, {\n          children: \"fromState\"\n        }), \" 是一种用来在字段间通信的机制。\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.code, {\n          children: \"fieldTransform\"\n        }), \" 用于在 Formly 处理或验证 fileds 之前转换成新的 fields 配置。\"]\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"验证器\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Formly 支持全局声明自定义验证器和错误信息，使用的时候只需传入之前定义的 key 值\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"export function IpValidator(control: FormControl): ValidationErrors {\\n  return /(\\\\d{1,3}\\\\.){3}\\\\d{1,3}/.test(control.value) ? null : { 'ip': true };\\n}\\n...\\n@NgModule({\\n  imports: [\\n    ...\\n    FormlyModule.forRoot({\\n      validators: [\\n        { name: 'ip', validation: IpValidator },\\n      ],\\n      validationMessages: [\\n        { name: 'ip', message: IpValidatorMessage },\\n        { name: 'required', message: 'This field is required' },\\n      ],\\n    }),\\n  ]\\n})\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"使用如下：\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"{\\n  key: 'ip',\\n  type: 'input',\\n  templateOptions: {\\n    label: 'IP Address (using custom validation declared in ngModule)',\\n    required: true,\\n  },\\n  validators: {\\n    validation: ['ip'],\\n  },\\n},\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"也可以在定义 field 值的时候引入自定义验证器，使用如下：\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"{\\n  key: 'ip',\\n  type: 'input',\\n  templateOptions: {\\n    label: 'IP Address (using custom validation through `validators.validation` property)',\\n    required: true,\\n  },\\n  validators: {\\n    validation: [IpValidator],\\n  },\\n\\tasyncValidators: {\\n    validation: [IpAsyncValidator],\\n\\t}\\n},\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"field 中的 validators 的值也可以是表达式的形势\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"NAME_OF_VALIDATOR: {\\n  expression: FUNCTION\\n  message: FUNCTION | STRING\\n}\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"示例如下：\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \" validators: {\\n    ip: {\\n      expression: (c) =\u003e /(\\\\d{1,3}\\\\.){3}\\\\d{1,3}/.test(c.value),\\n      message: (error, field: FormlyFieldConfig) =\u003e `\\\"${field.formControl.value}\\\" is not a valid IP Address`,\\n    },\\n  },\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"当然也可以是异步的，返回一个 promise 对象即可，示例如下：\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \" asyncValidators: {\\n    ip: {\\n      expression: (c) =\u003e return new Promise((resolve, reject) =\u003e {\\n        setTimeout(() =\u003e {\\n          resolve(/(\\\\d{1,3}\\\\.){3}\\\\d{1,3}/.test(c.value));\\n        }, 1000);\\n      }),\\n      message: (error, field: FormlyFieldConfig) =\u003e `\\\"${field.formControl.value}\\\" is not a valid IP Address`,\\n    },\\n  }\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"Formly 表达式\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Formly 定义了一种表达式格式，用于动态修改 field 值。主要通过\", _jsx(_components.code, {\n          children: \"hideExpression\"\n        }), \"和\", _jsx(_components.code, {\n          children: \"expressionProperties\"\n        }), \"两个字段来定义。\"]\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.code, {\n            children: \"hideExpression\"\n          }), \"用于动态显示表单字段\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"{\\n  key: 'iLikeTwix',\\n  type: 'checkbox',\\n  templateOptions: {\\n    label: 'I like twix',\\n  },\\n  hideExpression: '!model.name',\\n\\t// 也可以传入一个函数\\n\\thideExpression: (model: any, formState: any, field: FormlyFieldConfig) =\u003e {\\n    // access to the main model can be through `this.model` or `formState` or `model\\n    if (formState.mainModel \u0026\u0026 formState.mainModel.city) {\\n      return formState.mainModel.city !== \\\"123\\\"\\n    }\\n    return true;\\n  },\\n}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ol, {\n        start: \"2\",\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.code, {\n            children: \"expressionProperties\"\n          }), \"用于动态修改 field 中的属性\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"{\\n  key: 'text2',\\n  type: 'input',\\n  templateOptions: {\\n    label: 'Hey!',\\n    placeholder: 'This one is disabled if there is no text in the other input',\\n  },\\n  expressionProperties: {\\n    'templateOptions.disabled': '!model.text',\\n  },\\n\\t// 也可以传入一个函数\\n\\texpressionProperties: {\\n\\t\\t'templateOptions.disabled': (model: any, formState: any, field: FormlyFieldConfig) =\u003e {\\n\\t\\t\\t// access to the main model can be through `this.model` or `formState` or `model\\n\\t\\t\\treturn !formState.mainModel.text\\n\\t\\t},\\n  }\\n},\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"自定义模板\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"除了使用已支持的 UI 库，也可以自定义组件，步骤如下：\"\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"定义一个 component，继承自类\", _jsx(_components.code, {\n            children: \"FieldType\"\n          })]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"import { Component } from '@angular/core';\\nimport { FieldType } from '@ngx-formly/core';\\n\\n@Component({\\n selector: 'formly-field-input',\\n template: `\\n   \u003cinput type=\\\"input\\\" [formControl]=\\\"formControl\\\" [formlyAttributes]=\\\"field\\\"\u003e\\n `,\\n})\\nexport class FormlyFieldInput extends FieldType {}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ol, {\n        start: \"2\",\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"在 NgModule 装饰器中注册自定义类型\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"import { FormlyFieldInput } from './formly-field-input';\\n\\n@NgModule({\\n declarations: [FormlyFieldInput],\\n imports: [\\n   ....\\n   FormlyModule.forRoot({\\n     types: [\\n       { name: 'input', component: FormlyFieldInput },\\n     ],\\n   }),\\n ],\\n})\\nexport class AppModule {}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ol, {\n        start: \"3\",\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"在 fields 中使用\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"export class AppComponent {\\n fields: FormlyFieldConfig[] = [\\n   {\\n     key: 'firstname',\\n     type: 'input',\\n   },\\n ];\\n\\n ...\\n}\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"自定义 Wrapper\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.code, {\n          children: \"wrapper\"\n        }), \"是用于指定一个 component 来包装字段，使用不同的 template 会预设不同的 warpper，可以使用自定义 warpper 进行覆盖\"]\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"定义一个继承自类 FieldWrapper 的组件\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"import { Component, ViewChild, ViewContainerRef } from '@angular/core';\\nimport { FieldWrapper } from '@ngx-formly/core';\\n\\n@Component({\\nselector: 'formly-wrapper-panel',\\ntemplate: `\\n \u003cdiv class=\\\"card\\\"\u003e\\n   \u003ch3 class=\\\"card-header\\\"\u003eIts time to party\u003c/h3\u003e\\n   \u003ch3 class=\\\"card-header\\\"\u003e{{ to.label }}\u003c/h3\u003e\\n   \u003cdiv class=\\\"card-body\\\"\u003e\\n     \u003cng-container #fieldComponent\u003e\u003c/ng-container\u003e\\n   \u003c/div\u003e\\n \u003c/div\u003e\\n`,\\n})\\nexport class PanelWrapperComponent extends FieldWrapper {\\n}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ol, {\n        start: \"2\",\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"在 NgModule 装饰器中注册\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"import { NgModule } from '@angular/core';\\nimport { CommonModule } from '@angular/common';\\nimport { ReactiveFormsModule } from '@angular/forms';\\nimport { FormlyModule } from '@ngx-formly/core';\\nimport { FormlyBootstrapModule } from '@ngx-formly/bootstrap';\\n\\nimport { PanelWrapperComponent } from './panel-wrapper.component';\\nimport { AppComponent } from './app.component';\\n\\n@NgModule({\\nimports: [\\n CommonModule,\\n ReactiveFormsModule,\\n FormlyBootstrapModule,\\n FormlyModule.forRoot({\\n   wrappers: [\\n     { name: 'panel', component: PanelWrapperComponent },\\n   ],\\n }),\\n],\\ndeclarations: [\\n AppComponent,\\n PanelWrapperComponent,\\n],\\n})\\nexport class AppModule { }\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ol, {\n        start: \"3\",\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"在定义 fields 时使用\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"fields: FormlyFieldConfig[] = [\\n{\\n key: 'address',\\n wrappers: ['panel'],\\n templateOptions: { label: 'Address' },\\n fieldGroup: [{\\n   key: 'town',\\n   type: 'input',\\n   templateOptions: {\\n     required: true,\\n     type: 'text',\\n     label: 'Town',\\n   },\\n }],\\n},\\n];\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"也可以为特定的组件指定 wrapper\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"... //Imports\\n  @NgModule({\\n    imports: [\\n      CommonModule,\\n      ReactiveFormsModule,\\n      FormlyBootstrapModule,\\n      FormlyModule.forRoot({\\n        types: [\\n          {\\n            name: 'operator',\\n            component: OperatorComponent,\\n            wrappers: ['form-field']\\n          },\\n        ],\\n      }),\\n    ],\\n    declarations: [\\n      AppComponent,\\n      OperatorComponent\\n    ],\\n  })\\n  export class AppModule { }\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"使用 Formly 实现一个的动态表单\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"业务需求：实现一个输入表单，需要的输入参数信息由接口提供，输入个数不定，需要的参数有三种类型，分别为 string、volume、domain，string 类型用输入框填入，volume 类型用选择器填，domain 类型需要填入子域名并选择根域名。\"\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"接口返回的数据格式\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"let inputs: BpInputs = [\\n      {\\n        bpId: '07d46205-1c59-11ec-b603-0242ac130003',\\n        description: '请输入cloudname',\\n        type: 'string',\\n        internal: false,\\n        protocol: null,\\n        port: 0,\\n        required: true,\\n        initValue: {},\\n        hidden: false,\\n        path: '.bp',\\n        keyData: 'bp_cloudname',\\n        valueData: null,\\n        labelData: 'image-497f\u003ecloudname',\\n        default: null,\\n      },\\n      {\\n        bpId: '07d46205-1c59-11ec-b603-0242ac130003',\\n        description: '80端口服务的子域名',\\n        type: 'domain',\\n        internal: false,\\n        protocol: 'HTTP',\\n        port: 80,\\n        required: true,\\n        initValue: {},\\n        hidden: false,\\n        path: '.bp',\\n        keyData: 'bp_domain80',\\n        valueData: null,\\n        labelData: 'image-497f\u003e80端口访问域名',\\n        default: null,\\n      },\\n      {\\n        bpId: '07d46205-1c59-11ec-b603-0242ac130003',\\n        description: '存储路径',\\n        type: 'volume',\\n        internal: false,\\n        protocol: null,\\n        port: 0,\\n        required: true,\\n        initValue: { path: '/var/lib/nginx' },\\n        hidden: false,\\n        path: '.bp',\\n        keyData: 'bp_volume_var_lib_nginx',\\n        valueData: null,\\n        labelData: 'image-497f\u003e存储路径',\\n        default: null,\\n      },\\n    ];\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ol, {\n        start: \"2\",\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"获取接口数据并定义 fields 值\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"\\tform = new FormGroup({});\\n\\tmodel = {};\\n\\tfields: FormlyFieldConfig[] = [];\\n\\toptions: FormlyFormOptions;\\n\\tvolumeOptions = [{ label: 'aaa', value: 'aaa' }];\\n\\tdomainSuffix = [{ label: 'dev.xxx.cn', value: 'dev.xxx.cn' }];\\n\\n\\tconstructor(private formlyService: FormlyService) {}\\n\\n\\tngOnInit(): void {\\n\\t\\tthis.formlyService.getInputs().subscribe((res) =\u003e {\\n\\t\\t\\tthis.initFields(res);\\n\\t\\t});\\n\\t}\\n\\n\\tinitFields(inputs: BpInputs) {\\n\\t\\tthis.fields = inputs.map((input): FormlyFieldConfig =\u003e {\\n\\t\\t\\tconst { keyData: key, labelData, type, hidden, required } = input;\\n\\n\\t\\t\\tlet field = {\\n\\t\\t\\t\\tkey,\\n\\t\\t\\t\\tname: key,\\n\\t\\t\\t\\thide: hidden,\\n\\t\\t\\t\\ttemplateOptions: {\\n\\t\\t\\t\\t\\trequired,\\n\\t\\t\\t\\t\\tlabel: labelData,\\n\\t\\t\\t\\t},\\n\\t\\t\\t};\\n\\n\\t\\t\\tswitch (type) {\\n\\t\\t\\t\\tcase 'string': {\\n\\t\\t\\t\\t\\treturn { ...field, type: 'input' };\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tcase 'volume': {\\n\\t\\t\\t\\t\\tlet { templateOptions, ...oth } = field;\\n\\t\\t\\t\\t\\treturn {\\n\\t\\t\\t\\t\\t\\t...oth,\\n\\t\\t\\t\\t\\t\\ttype: 'select',\\n\\t\\t\\t\\t\\t\\ttemplateOptions: {\\n\\t\\t\\t\\t\\t\\t\\t...templateOptions,\\n\\t\\t\\t\\t\\t\\t\\toptions: this.volumeOptions,\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tcase 'domain':\\n\\t\\t\\t\\t\\treturn {\\n\\t\\t\\t\\t\\t\\tfieldGroupClassName: 'domain-group',\\n\\t\\t\\t\\t\\t\\tfieldGroup: [\\n\\t\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\t\\tkey: `${key}-prefix`,\\n\\t\\t\\t\\t\\t\\t\\t\\tname: `${key}-prefix`,\\n\\t\\t\\t\\t\\t\\t\\t\\ttype: 'input',\\n\\t\\t\\t\\t\\t\\t\\t\\tclassName: 'flex-2',\\n\\t\\t\\t\\t\\t\\t\\t\\ttemplateOptions: {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\trequired,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tlabel: labelData,\\n\\t\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\t\\tkey: `${key}-suffix`,\\n\\t\\t\\t\\t\\t\\t\\t\\tname: `${key}-suffix`,\\n\\t\\t\\t\\t\\t\\t\\t\\ttype: 'select',\\n\\t\\t\\t\\t\\t\\t\\t\\tclassName: 'flex-1',\\n\\t\\t\\t\\t\\t\\t\\t\\ttemplateOptions: {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\trequired,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\toptions: this.domainSuffix,\\n\\t\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t],\\n\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\treturn field;\\n\\t\\t\\t}\\n\\t\\t});\\n\\t}\\n\\n\\tsubmit() {\\n\\t\\tconsole.log('model', this.model);\\n\\t}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ol, {\n        start: \"3\",\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"定义使用formly-form组件\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"\u003cform [formGroup]=\\\"form\\\" (ngSubmit)=\\\"submit()\\\"\u003e\\n  \u003cformly-form [form]=\\\"form\\\" [fields]=\\\"fields\\\" [model]=\\\"model\\\"\u003e\u003c/formly-form\u003e\\n  \u003cnz-form-item\u003e\\n    \u003cnz-form-control [nzOffset]=\\\"8\\\"\u003e\\n      \u003cbutton nzType=\\\"primary\\\" nz-button\u003e保存\u003c/button\u003e\\n    \u003c/nz-form-control\u003e\\n  \u003c/nz-form-item\u003e\\n\u003c/form\u003e\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ol, {\n        start: \"4\",\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"查看显示效果：\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.img, {\n          src: \"/posts-img/input-form.png\",\n          alt: \"\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"实现自定义模板\"\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"实现一个自定义表单控件\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"定义 Formly 模板\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"注册自定义模板\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{"title":"动态表单库 Formly","date":"2021-09-22 21:00:00","description":"介绍在Angular中如何使用Formly让动态表单实现更简洁。"}},"frontMatter":{"title":"动态表单库 Formly","date":"2021-09-22 21:00:00","description":"介绍在Angular中如何使用Formly让动态表单实现更简洁。"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"formly"},"buildId":"eQHzwepfXML6lMuZMdrtB","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>