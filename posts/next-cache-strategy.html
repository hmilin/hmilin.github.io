<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Meiling&#x27;s Blog</title><meta name="description" content="meilingçš„åšå®¢"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/275b2a15ad29278d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/275b2a15ad29278d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/be3b6285a2614a27.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be3b6285a2614a27.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-a85322f027b40e20.js" defer=""></script><script src="/_next/static/chunks/main-6c11f3d61c45c1c1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ab4c043ec570de8c.js" defer=""></script><script src="/_next/static/chunks/196-32419b2dc902ac8d.js" defer=""></script><script src="/_next/static/chunks/927-f194a212e80173e6.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-ff83de698e35108e.js" defer=""></script><script src="/_next/static/NYhGD9KYsWK6ZpgmhG3ox/_buildManifest.js" defer=""></script><script src="/_next/static/NYhGD9KYsWK6ZpgmhG3ox/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_container__XDtoS"><header class="Header_header__aO32P"><div class="Header_mobileNav__x8dOm"><div class="Header_menuIcon__zsaJW"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M120-240v-80h720v80zm0-200v-80h720v80zm0-200v-80h720v80z"></path></svg></div><a class="Header_searchBtn__DiCC5" href="/search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580t75.5-184.5T380-840t184.5 75.5T640-580q0 44-14 83t-38 69l252 252zM380-400q75 0 127.5-52.5T560-580t-52.5-127.5T380-760t-127.5 52.5T200-580t52.5 127.5T380-400"></path></svg></a></div><nav class="Header_nav__wk8Zc"><div class="Header_closeIcon__TBNuf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224z"></path></svg></div><a class="Header_searchBtn__DiCC5" href="/search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580t75.5-184.5T380-840t184.5 75.5T640-580q0 44-14 83t-38 69l252 252zM380-400q75 0 127.5-52.5T560-580t-52.5-127.5T380-760t-127.5 52.5T200-580t52.5 127.5T380-400"></path></svg></a><a class="" href="/"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M200-160v-366L88-440l-48-64 440-336 160 122v-82h120v174l160 122-48 64-112-86v366H520v-240h-80v240zm80-80h80v-240h240v240h80v-347L480-739 280-587zm120-319h160q0-32-24-52.5T480-632t-56 20.5-24 52.5m-40 319v-240h240v240-240H360z"></path></svg></div><div class="Header_title__BTC6R">é¦–é¡µ</div></a><a class="" href="/category/native"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M200-640v440h560v-440H640v320l-160-80-160 80v-320zm0 520q-33 0-56.5-23.5T120-200v-499q0-14 4.5-27t13.5-24l50-61q11-14 27.5-21.5T250-840h460q18 0 34.5 7.5T772-811l50 61q9 11 13.5 24t4.5 27v499q0 33-23.5 56.5T760-120zm16-600h528l-34-40H250zm184 80v190l80-40 80 40v-190zm-200 0h560z"></path></svg></div><div class="Header_title__BTC6R">åŸç”ŸåŸºç¡€</div></a><a class="" href="/category/framework"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M400-400h160v-80H400zm0-120h320v-80H400zm0-120h320v-80H400zm-80 400q-33 0-56.5-23.5T240-320v-480q0-33 23.5-56.5T320-880h480q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240zm0-80h480v-480H320zM160-80q-33 0-56.5-23.5T80-160v-560h80v560h560v80zm160-720v480z"></path></svg></div><div class="Header_title__BTC6R">æ¡†æ¶ç›¸å…³</div></a><a class="" href="/category/tool"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="m620-284 56-56q6-6 6-14t-6-14L540-505q4-11 6-22t2-25q0-57-40.5-97.5T410-690q-17 0-34 4.5T343-673l94 94-56 56-94-94q-8 16-12.5 33t-4.5 34q0 57 40.5 97.5T408-412q13 0 24.5-2t22.5-6l137 136q6 6 14 6t14-6M480-80q-83 0-156-31.5T197-197t-85.5-127T80-480t31.5-156T197-763t127-85.5T480-880t156 31.5T763-763t85.5 127T880-480t-31.5 156T763-197t-127 85.5T480-80m0-80q134 0 227-93t93-227-93-227-227-93-227 93-93 227 93 227 227 93m0-320"></path></svg></div><div class="Header_title__BTC6R">å·¥å…·ä½¿ç”¨</div></a><a class="" href="/about"><div class="Header_icon__SYetk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#5f6368" viewBox="0 -960 960 960"><path d="M360-390q-21 0-35.5-14.5T310-440t14.5-35.5T360-490t35.5 14.5T410-440t-14.5 35.5T360-390m240 0q-21 0-35.5-14.5T550-440t14.5-35.5T600-490t35.5 14.5T650-440t-14.5 35.5T600-390M480-160q134 0 227-93t93-227q0-24-3-46.5T786-570q-21 5-42 7.5t-44 2.5q-91 0-172-39T390-708q-32 78-91.5 135.5T160-486v6q0 134 93 227t227 93m0 80q-83 0-156-31.5T197-197t-85.5-127T80-480t31.5-156T197-763t127-85.5T480-880t156 31.5T763-763t85.5 127T880-480t-31.5 156T763-197t-127 85.5T480-80m-54-715q42 70 114 112.5T700-640q14 0 27-1.5t27-3.5q-42-70-114-112.5T480-800q-14 0-27 1.5t-27 3.5M177-581q51-29 89-75t57-103q-51 29-89 75t-57 103m146-178"></path></svg></div><div class="Header_title__BTC6R">å…³äº</div></a></nav></header><div><main><div class="Layout_cover__vC5GW"><div><h1>Next.js ä¸­App Routerçš„ç¼“å­˜ç­–ç•¥</h1><p>Next.js ä¸­App Routerçš„ç¼“å­˜ç­–ç•¥çš„å½’çº³å’Œä½¿ç”¨</p><div>2024-6-18 18:30</div></div></div><div class="content-container"><h1>Next.js ä¸­ App Router çš„ç¼“å­˜ç­–ç•¥</h1>
<p>Next.js çš„<code>App Router</code>æ¨¡å¼ä¸‹çš„ç¼“å­˜ç­–ç•¥æ¯”åŸå…ˆçš„<code>Page Router</code>ä¸°å¯Œäº†å¾ˆå¤šã€‚åœ¨åŸæ¥çš„ Page Routerï¼Œåªæœ‰è·¯ç”±ä¸€ç§ç¼“å­˜å¯¹è±¡ï¼Œåœ¨ä½¿ç”¨<code>getStaticProps</code>å’Œ<code>getServerSideProps</code>ä¸¤ä¸ªé’©å­çš„ä½¿ç”¨ç›´æ¥ä»£è¡¨äº†ä½¿ç”¨ç¼“å­˜ä¸ä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ²¡æœ‰æ›´å¤šçš„æ“æ§ç©ºé—´ï¼Œè¡Œä¸ºä¹Ÿå¾ˆå®¹æ˜“é¢„æµ‹ã€‚</p>
<p>åœ¨ä½¿ç”¨ App Router æ¨¡å¼åï¼Œç¼“å­˜çš„è§„åˆ™ä¸°å¯Œäº†å¾ˆå¤šï¼Œä¹Ÿç»™å‡ºä¸€äº›å¯ä¾›ç”¨æˆ·ä½¿ç”¨çš„ APIï¼Œè™½ç„¶ Next.js çš„æ–‡æ¡£ç§°äº†è§£ç¼“å­˜ç­–ç•¥ä¸æ˜¯å¿…é¡»çš„ï¼Œåœ¨å¯¹ Next ä¸­çš„ API è°ƒç”¨æ—¶ï¼Œæ¡†æ¶å·²ç»ä½¿ç”¨äº†æœ€ä¼˜çš„ç¼“å­˜æ–¹å¼ã€‚ä½†éšç€ä¸šåŠ¡å¼€å‘çš„ä¸°å¯Œï¼Œé»˜è®¤çš„ cache è¡Œä¸ºäº§ç”Ÿäº†ä¸€äº›æ„æ–™ä¸åˆ°çš„å¼‚å¸¸ï¼Œå› æ­¤åœ¨ç»è¿‡ä¸€ç•ªèµ„æ–™é˜…è¯»ä¹‹ååšä¸€äº›æ€»ç»“ã€‚</p>
<h2>ç¼“å­˜åˆ†ç±»</h2>
<table><thead><tr><th>ç­–ç•¥</th><th>å¯¹è±¡</th><th>ä½ç½®</th><th>ç›®çš„</th><th>æ—¶æœº</th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/app/building-your-application/caching#request-memoization">Request Memoization</a></td><td>å‡½æ•°è¿”å›å€¼</td><td>Server</td><td>åœ¨ react ç»„ä»¶æ ‘ä¸­å¤ç”¨æ•°æ®</td><td>æ¯ä¸ªè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/caching#data-cache">Data Cache</a></td><td>æ•°æ®</td><td>Server</td><td>è·¨ç”¨æˆ·è¯·æ±‚å’Œéƒ¨ç½²å…±äº«æ•°æ®</td><td>æŒä¹…ï¼ˆå¯ä»¥é‡æ–°éªŒè¯ï¼‰</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/caching#full-route-cache">Full Route Cache</a></td><td>HTML å’Œ RSC payload</td><td>Server</td><td>å‡å°‘æ¸²æŸ“æˆæœ¬å’Œæé«˜æ€§èƒ½</td><td>æŒä¹…ï¼ˆå¯ä»¥é‡æ–°éªŒè¯ï¼‰</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/caching#router-cache">Router Cache</a></td><td>RSC Payload</td><td>Client</td><td>åœ¨è·¯ç”±å˜åŒ–æ—¶å‡å°‘æœåŠ¡ç«¯è¯·æ±‚</td><td>ç”¨æˆ·ä¼šè¯æˆ–åŸºäºæ—¶é—´</td></tr></tbody></table>
<h2>Request Memorization</h2>
<p>Request Memorization æ˜¯å®Œå…¨ç»§æ‰¿è‡ª React çš„è¡Œä¸ºï¼ŒReact åŸºäº fetch API çš„è‡ªåŠ¨ç¼“å­˜ç­–ç•¥å®ç°äº†åœ¨ç»„ä»¶æ ‘ä¸­å¯¹ request çš„ç¼“å­˜ï¼Œè¯¦è§ React æ–‡æ¡£<a href="https://react.dev/reference/react/cache">cache</a>ã€‚åœ¨å¤šä¸ªç»„ä»¶ä¸­è°ƒç”¨åŒä¸€ä¸ªæ¥å£æ—¶ï¼Œå·²æ— éœ€åœ¨æ ¹ç»„ä»¶è°ƒç”¨æ•°æ®ç„¶åä¼ é€’åˆ°å­ç»„ä»¶ï¼Œç›´æ¥åœ¨éœ€è¦æ•°æ®ä¸­çš„ç»„ä»¶è°ƒç”¨ï¼Œreact ä¼šæå–å¹¶ç¼“å­˜ requestï¼ˆåªå¯¹ fetch GET è¯·æ±‚èµ·ä½œç”¨ï¼‰ï¼Œè¿™ä¸ªè¡Œä¸ºåªå‘ç”Ÿåœ¨æœåŠ¡ç«¯ç»„ä»¶ï¼Œä¸”æ‰€æœ‰ react çš„ ssr æ¡†æ¶ä¼šæœ‰ä¸€è‡´çš„è¡Œä¸ºã€‚</p>
<p>åœ¨ nextjs ä¸­ï¼Œç¼“å­˜åªå‘ç”Ÿåœ¨åŒä¸€æ¬¡è¯·æ±‚å’Œæ¸²æŸ“ä¸­ï¼Œå› æ­¤æ²¡æœ‰æ¸…é™¤ç¼“å­˜çš„å…¥å£å’Œå¿…è¦æ€§ã€‚</p>
<h2>Data Cache</h2>
<p>Next.js å®ç°äº†å¯¹æ„å»ºæ•°æ®å’ŒæœåŠ¡ç«¯è¯·æ±‚æ•°æ®çš„ç¼“å­˜ã€‚ç”±äº Next.js æ˜¯åŸºäº fetch API å®ç°äº†è¯¥æ–¹é¢çš„ç¼“å­˜ï¼Œç”¨æˆ·å¯ä»¥é’ˆå¯¹æ¯ä¸ª fetch è¯·æ±‚è®¾ç½®å‚æ•°æ¥å®ç°ä¸ä¸€æ ·çš„ç¼“å­˜ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰æœåŠ¡ç«¯çš„ fetch è¯·æ±‚éƒ½ä¼šè¢«ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨<code>cache</code>å’Œ<code>next.revalidate</code>Â  æ“æ§ã€‚</p>
<p>Next.js ä¼šä¿æŒä½¿ç”¨æ•°æ®ç¼“å­˜ï¼Œé™¤éç”¨æˆ·æ‰‹åŠ¨é‡æ–°éªŒè¯æˆ–ç¦ç”¨ç¼“å­˜ã€‚è§¦å‘é‡æ–°éªŒè¯çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šåŸºäºæ—¶é—´é‡æ–°éªŒè¯ã€æŒ‰éœ€é‡æ–°éªŒè¯ã€‚</p>
<h3>åŸºäºæ—¶é—´é‡æ–°éªŒè¯</h3>
<p>é€šè¿‡ fetch æ¥å£åˆ¶å®šæ—¶é—´å‚æ•°æ¥å‘Šè¯‰ next ä½•æ—¶é‡æ–°éªŒè¯ã€‚ç¬¬ä¸€æ¬¡ä»å¤–éƒ¨æ•°æ®æºå–æ•°æ®ä¹‹å next ä¼šå°†æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹å‰é‡æ–°è¯·æ±‚æ•°æ®ï¼Œéƒ½å°†ä»ç¼“å­˜ä¸­æ‹¿ï¼Œè¶…è¿‡æŒ‡å®šæ—¶é—´ä¹‹åä¼šé‡æ–°è®¤è¯å¹¶è¿”å›æœ€æ–°æ•°æ®ï¼Œæ–°ä¸€è½®çš„ç¼“å­˜æ—¶é—´ä»å¤´å¼€å§‹è®¡ç®—ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ—§æ•°æ®ä¼šä¿æŒåˆ°æ–°æ•°æ®æ‹¿åˆ°ä¹‹åæ‰è¢«æ›¿æ¢ï¼Œæœ‰ç‚¹ç±»ä¼¼ stale-while-revalidate çš„è¡Œä¸ºã€‚</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#65737e">// Revalidate at most every hour</span><span>
</span><span>fetch(</span><span style="color:#a3be8c">&quot;https://...&quot;</span><span>, { next: { revalidate: </span><span style="color:#d08770">3600</span><span> } });
</span></code></pre>
<h3>æŒ‰éœ€é‡æ–°éªŒè¯</h3>
<p>æŒ‰éœ€é‡æ–°è®¤è¯ä¸»è¦é€šè¿‡ä¸¤ä¸ª API å®Œæˆï¼š <code>revalidatePath</code> å’Œ<code>revalidateTag</code> ï¼Œ<code>revalidatePath</code> ç”¨äºæŒ‡å®šæŸä¸ªè·¯ç”±ä¸‹çš„æ•°æ®ç¼“å­˜éœ€è¦é‡æ–°è®¤è¯ï¼Œ<code>revalidateTag</code> éœ€è¦é€šè¿‡ fetch çš„<code>options.next.tags</code> å‚æ•°æŒ‡å®š tag æ¥ä½¿ç”¨ã€‚</p>
<p>ä»å¤–éƒ¨æ•°æ®è¯·æ±‚æ—¶æ•°æ®ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œè°ƒç”¨<code>revalidatePath</code> æˆ–<code>revalidateTag</code>æ—¶ï¼Œç¼“å­˜ä¼šè¢«æ¸…é™¤ï¼Œå†æ¬¡è¯·æ±‚æ—¶ä¼šä»å¤–éƒ¨æ•°æ®æºæ‹¿æœ€æ–°çš„æ•°æ®ã€‚</p>
<p><strong>åœ¨ client ç»„ä»¶è°ƒç”¨</strong></p>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæœ‰éœ€è¦åœ¨ client ç»„ä»¶ä¸­è§¦å‘é‡æ–°è®¤è¯çš„åœºæ™¯ï¼Œæ¯”å¦‚æ›´æ–°äº†ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œæˆ–ä¿®æ”¹äº†ä¸€äº›æ•°æ®éœ€è¦åŠæ—¶å±•ç¤ºã€‚è€Œ<code>revalidatePath</code> å’Œ<code>revalidateTag</code>ä¸¤ä¸ªæ–¹æ³•æ˜¯åœ¨æœåŠ¡ç«¯è°ƒç”¨çš„ï¼Œè¿™æ—¶éœ€è¦å£°æ˜<code>Server Actions</code>ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è°ƒç”¨è¯¥å‡½æ•°ã€‚</p>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span style="color:#a3be8c">&quot;use server&quot;</span><span>;
</span>
<span></span><span style="color:#b48ead">import</span><span> { revalidatePath } </span><span style="color:#b48ead">from</span><span> </span><span style="color:#a3be8c">&quot;next/cache&quot;</span><span>;
</span>
<span></span><span style="color:#b48ead">export</span><span> </span><span style="color:#b48ead">async</span><span> </span><span class="hljs-function" style="color:#b48ead">function</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#8fa1b3">createPost</span><span class="hljs-function">(</span><span class="hljs-function">) </span><span>{
</span><span>  </span><span style="color:#b48ead">try</span><span> {
</span><span>    </span><span style="color:#65737e">// ...</span><span>
</span><span>  } </span><span style="color:#b48ead">catch</span><span> (error) {
</span><span>    </span><span style="color:#65737e">// ...</span><span>
</span>  }
<!-- -->
<span>  revalidatePath(</span><span style="color:#a3be8c">&quot;/posts&quot;</span><span>);
</span>}
</code></pre>
<h3>ç¦ç”¨ç¼“å­˜</h3>
<p>next æä¾›ç»™äº†å‡ ç§æ–¹å¼ç”¨äºå£°æ˜ä¸ä½¿ç”¨ç¼“å­˜</p>
<ol>
<li>ä½¿ç”¨ fetch çš„ no-store å‚æ•°ï¼Œå¯¹äºåœ¨æµè§ˆå™¨å‘å‡ºçš„è¯·æ±‚ï¼Œå£°æ˜ no-store å¯ä»¥ç»•è¿‡å¼ºåˆ¶ç¼“å­˜ï¼Œåœ¨ next æœåŠ¡ç«¯è°ƒç”¨çš„ fetch ä¹Ÿæ²¿ç”¨äº†è¿™ä¸€è®¾å®šã€‚</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>// Opt out of caching for an individual `fetch` request
</span><span>fetch(`https://...`, { cache: </span><span style="color:#a3be8c">&quot;no-store&quot;</span><span> })</span><span style="color:#65737e">;</span><span>
</span></code></pre>
<ol>
<li>åœ¨ layout æˆ– page ä¸­å£°æ˜åŠ¨æ€æ¸²æŸ“å‚æ•°</li>
</ol>
<pre style="display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:0.5em"><code class="block-code" style="white-space:pre"><span>const </span><span class="hljs-attr">dynamic</span><span> = </span><span style="color:#a3be8c">&quot;force-dynamic&quot;</span><span style="color:#65737e">;</span><span>
</span></code></pre>
<h2>Full Route Cache</h2>
<p>è¿™ä¸€éƒ¨åˆ†çš„ç¼“å­˜å¯¹è±¡æ˜¯æ„å»ºäº§ç”Ÿçš„ html å’Œ RSC Payloadï¼Œhtml æ¥è‡ªæ„å»ºæ—¶æ³¨å…¥çš„é™æ€æ•°æ®æˆ–é¢„æ¸²æŸ“æ•°æ®ï¼Œå’Œè¯·æ±‚æ—¶åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„ html ç»“æœï¼ŒRSC Payload åˆ™æ˜¯ä¸€ä»½å¤æ‚çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒåŒ…å«äº†æœåŠ¡ç«¯ç»„ä»¶çš„æ¸²æŸ“ç»“æœã€å®¢æˆ·ç«¯ç»„ä»¶çš„å ä½ä¿¡æ¯å’Œ js æ–‡ä»¶ã€ä»æœåŠ¡ç«¯ç»„ä»¶ä¼ é€’åˆ°å®¢æˆ·ç«¯ç»„ä»¶çš„ä»»ä½•å±æ€§ã€‚</p>
<p><strong>é‡æ–°éªŒè¯çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼š</strong></p>
<p>ä¸€ç§æ˜¯é‡æ–°éƒ¨ç½²ï¼Œä¸€ç§æ˜¯é‡æ–°éªŒè¯ç†ç”±ä¸‹çš„ Data Cacheã€‚</p>
<p>åœ¨ client çš„è·¯ç”±è·³è½¬ä¸­ï¼Œå½“è·³è½¬åˆ°æŸä¸ªè·¯ç”±ä¸‹æ—¶ï¼Œnext å‘é€çš„ GET è¯·æ±‚<code>/{path}?_rsc=xxx</code> ï¼Œ_rsc ä»£è¡¨ä¸€ä¸ª cacheKeyï¼Œå½“é‡æ–°éªŒè¯ Data Cache çš„æ—¶å€™ï¼Œä½¿ç”¨è¯¥æ•°æ®æºçš„è·¯ç”±çš„ cacheKey ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå½“è·³è½¬çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯é€šè¿‡ cacheKey çš„å˜åŒ–çŸ¥é“è¯¥å¿½ç•¥ç¼“å­˜ã€‚</p>
<h2>Router Cache</h2>
<p>Router Cache æ˜¯åœ¨å®¢æˆ·ç«¯å¯¹å·²åŠ è½½æˆ–é¢„åŠ è½½çš„è·¯ç”±çš„ç¼“å­˜ï¼Œä¸ Full Router Cache ä¸åŒçš„æ˜¯ï¼šRouter Cache åªåœ¨ç›¸åŒçš„ç”¨æˆ·ä¼šè¯ä¸­ç¼“å­˜ï¼Œæ”¯æŒç¼“å­˜é™æ€æ¸²æŸ“å’ŒåŠ¨æ€æ¸²æŸ“ã€‚</p>
<p>Router Cache å­˜åœ¨æ•´ä¸ªä¼šè¯æœŸé—´ï¼Œåœ¨åˆ·æ–°é¡µé¢åå¤±æ•ˆã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ next.js å†…ç½®äº†åŸºäºæ—¶é—´çš„è¿‡æœŸç­–ç•¥ï¼š</p>
<ul>
<li>é™æ€æ¸²æŸ“å¹¶æŒ‡å®šäº† prefetch çš„è·¯ç”±ï¼Œè¿‡æœŸæ—¶é—´ä¸º 5 åˆ†é’Ÿ</li>
<li>prefetch=<!-- -->Â  æˆ–æœªæŒ‡å®šï¼Œæˆ–ä¸ºåŠ¨æ€æ¸²æŸ“çš„é¡µé¢ï¼Œè¿‡æœŸæ—¶é—´ä¸º 30s</li>
</ul>
<p>ä»é¡µé¢ä¸Šçš„æ•ˆæœæ¥çœ‹ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´å†…è·³è½¬è·¯ç”±ï¼Œå®¢æˆ·ç«¯ä¹‹é—´æ‹¿ä¹‹å‰çš„ç¼“å­˜æ¸²æŸ“ï¼Œä¸ä¼šå†é‡æ–°è¯·æ±‚æœåŠ¡å™¨ï¼ˆä¸å‘é€<code>/{path}?_rsc=xxx</code> è¯·æ±‚ï¼‰ã€‚</p>
<aside><p>ğŸ”‘ åœ¨next@14.2.0-canary.53ä¹‹åçš„ç‰ˆæœ¬ä¸­æ”¯æŒäº†è¿‡æœŸæ—¶é—´çš„è®¾ç½®
<a href="https://nextjs.org/docs/app/api-reference/next-config-js/staleTimes">https://nextjs.org/docs/app/api-reference/next-config-js/staleTimes</a></p></aside>
<h3>æ‰‹åŠ¨åºŸå¼ƒ</h3>
<p>æ‰§è¡Œä»¥ä¸‹ API ä¹Ÿå¯ä»¥æ‰‹åŠ¨åºŸå¼ƒæ‰ç¼“å­˜</p>
<ul>
<li>æœåŠ¡ç«¯ api<!-- -->
<ul>
<li><code>revalidatePath</code> æˆ–<code>revalidateTag</code></li>
<li><a href="https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options"><code>cookies.set</code></a>Â  æˆ– Â <a href="https://nextjs.org/docs/app/api-reference/functions/cookies#deleting-cookies"><code>cookies.delete</code></a></li>
</ul>
</li>
<li>å®¢æˆ·ç«¯ä¸‹çš„<a href="https://nextjs.org/docs/app/api-reference/functions/use-router"><code>router.refresh</code></a></li>
</ul>
<h2>æ€»ç»“</h2>
<p>è™½ç„¶ç¼“å­˜åˆ† 4 ç§ï¼Œä½†æ¯ç§ç¼“å­˜ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œå½“ä½ é€šè¿‡æŸä¸ª API é‡æ–°éªŒè¯æŸä¸€ç±»ç¼“å­˜æ—¶ï¼Œå…¶ä»–ç¼“å­˜ä¹Ÿå¯èƒ½è·Ÿç€è¢«æ›´æ–°ï¼Œå› æ­¤éœ€è¦æ ¹æ®å…·ä½“çš„ä½¿ç”¨æƒ…å†µå’Œç°è±¡æ¥åˆ†æå¹¶ç¡®è®¤æœ€ä½³ä½¿ç”¨æ–¹å¼ã€‚</p>
<h2>å»¶ç”³æ€è€ƒ</h2>
<p>Next.js çš„ APP Router ç¡®å®æ¯”è¾ƒéš¾ç”¨ï¼Œæœ‰åˆ«äºä¼ ç»Ÿçš„ SPA åº”ç”¨ï¼Œåœ¨å¼€å‘ next åº”ç”¨æ—¶æˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘ä»£ç æˆ–ç»„ä»¶å“ªäº›éƒ¨åˆ†å·¥ä½œåœ¨å®¢æˆ·ç«¯å“ªäº›éƒ¨åˆ†å·¥ä½œåœ¨æœåŠ¡ç«¯ï¼Œä½†å®ƒç¡®å®æä¾›äº†å¾ˆå¤šæ€§èƒ½ä¼˜åŒ–çš„ä¼˜è´¨å®è·µæ–¹å¼ã€‚åœ¨å¯¹ Next.js æ›´æ·±å…¥çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œè¿˜èƒ½å‘ç°ä¸€äº› React å®˜æ–¹æœ€æ–°æä¾›çš„å®éªŒæ€§ API å’Œä¸€äº›æœªæ¥å‘å±•çš„è¶‹åŠ¿ã€‚</p>
<h2>å‚è€ƒèµ„æ–™</h2>
<p><a href="https://nextjs.org/docs/app/building-your-application/caching#data-cache">Next.js æ–‡æ¡£- App Router-Caching</a></p>
<p><a href="https://nextjs.org/docs/app/building-your-application/caching#apis">ä¸ç¼“å­˜ç›¸å…³çš„ API</a></p>
<p><a href="https://github.com/vercel/next.js/discussions/54075">Github discussion ä¸­å¯¹ç¼“å­˜çš„æ·±åº¦è®¨è®º</a></p></div><div class="content-container"></div></main><footer class="grid place-items-center pb-4"><a href="https://github.com/hmilin" target="_blank" rel="noreferrer noopener">ğŸ˜˜Github</a></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    code: \"code\",\n    h2: \"h2\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    a: \"a\",\n    h3: \"h3\",\n    pre: \"pre\",\n    strong: \"strong\",\n    ol: \"ol\",\n    li: \"li\",\n    ul: \"ul\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"Next.js ä¸­ App Router çš„ç¼“å­˜ç­–ç•¥\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Next.js çš„\", _jsx(_components.code, {\n        children: \"App Router\"\n      }), \"æ¨¡å¼ä¸‹çš„ç¼“å­˜ç­–ç•¥æ¯”åŸå…ˆçš„\", _jsx(_components.code, {\n        children: \"Page Router\"\n      }), \"ä¸°å¯Œäº†å¾ˆå¤šã€‚åœ¨åŸæ¥çš„ Page Routerï¼Œåªæœ‰è·¯ç”±ä¸€ç§ç¼“å­˜å¯¹è±¡ï¼Œåœ¨ä½¿ç”¨\", _jsx(_components.code, {\n        children: \"getStaticProps\"\n      }), \"å’Œ\", _jsx(_components.code, {\n        children: \"getServerSideProps\"\n      }), \"ä¸¤ä¸ªé’©å­çš„ä½¿ç”¨ç›´æ¥ä»£è¡¨äº†ä½¿ç”¨ç¼“å­˜ä¸ä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ²¡æœ‰æ›´å¤šçš„æ“æ§ç©ºé—´ï¼Œè¡Œä¸ºä¹Ÿå¾ˆå®¹æ˜“é¢„æµ‹ã€‚\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åœ¨ä½¿ç”¨ App Router æ¨¡å¼åï¼Œç¼“å­˜çš„è§„åˆ™ä¸°å¯Œäº†å¾ˆå¤šï¼Œä¹Ÿç»™å‡ºä¸€äº›å¯ä¾›ç”¨æˆ·ä½¿ç”¨çš„ APIï¼Œè™½ç„¶ Next.js çš„æ–‡æ¡£ç§°äº†è§£ç¼“å­˜ç­–ç•¥ä¸æ˜¯å¿…é¡»çš„ï¼Œåœ¨å¯¹ Next ä¸­çš„ API è°ƒç”¨æ—¶ï¼Œæ¡†æ¶å·²ç»ä½¿ç”¨äº†æœ€ä¼˜çš„ç¼“å­˜æ–¹å¼ã€‚ä½†éšç€ä¸šåŠ¡å¼€å‘çš„ä¸°å¯Œï¼Œé»˜è®¤çš„ cache è¡Œä¸ºäº§ç”Ÿäº†ä¸€äº›æ„æ–™ä¸åˆ°çš„å¼‚å¸¸ï¼Œå› æ­¤åœ¨ç»è¿‡ä¸€ç•ªèµ„æ–™é˜…è¯»ä¹‹ååšä¸€äº›æ€»ç»“ã€‚\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"ç¼“å­˜åˆ†ç±»\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"ç­–ç•¥\"\n          }), _jsx(_components.th, {\n            children: \"å¯¹è±¡\"\n          }), _jsx(_components.th, {\n            children: \"ä½ç½®\"\n          }), _jsx(_components.th, {\n            children: \"ç›®çš„\"\n          }), _jsx(_components.th, {\n            children: \"æ—¶æœº\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.a, {\n              href: \"https://nextjs.org/docs/app/building-your-application/caching#request-memoization\",\n              children: \"Request Memoization\"\n            })\n          }), _jsx(_components.td, {\n            children: \"å‡½æ•°è¿”å›å€¼\"\n          }), _jsx(_components.td, {\n            children: \"Server\"\n          }), _jsx(_components.td, {\n            children: \"åœ¨ react ç»„ä»¶æ ‘ä¸­å¤ç”¨æ•°æ®\"\n          }), _jsx(_components.td, {\n            children: \"æ¯ä¸ªè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.a, {\n              href: \"https://nextjs.org/docs/app/building-your-application/caching#data-cache\",\n              children: \"Data Cache\"\n            })\n          }), _jsx(_components.td, {\n            children: \"æ•°æ®\"\n          }), _jsx(_components.td, {\n            children: \"Server\"\n          }), _jsx(_components.td, {\n            children: \"è·¨ç”¨æˆ·è¯·æ±‚å’Œéƒ¨ç½²å…±äº«æ•°æ®\"\n          }), _jsx(_components.td, {\n            children: \"æŒä¹…ï¼ˆå¯ä»¥é‡æ–°éªŒè¯ï¼‰\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.a, {\n              href: \"https://nextjs.org/docs/app/building-your-application/caching#full-route-cache\",\n              children: \"Full Route Cache\"\n            })\n          }), _jsx(_components.td, {\n            children: \"HTML å’Œ RSC payload\"\n          }), _jsx(_components.td, {\n            children: \"Server\"\n          }), _jsx(_components.td, {\n            children: \"å‡å°‘æ¸²æŸ“æˆæœ¬å’Œæé«˜æ€§èƒ½\"\n          }), _jsx(_components.td, {\n            children: \"æŒä¹…ï¼ˆå¯ä»¥é‡æ–°éªŒè¯ï¼‰\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.a, {\n              href: \"https://nextjs.org/docs/app/building-your-application/caching#router-cache\",\n              children: \"Router Cache\"\n            })\n          }), _jsx(_components.td, {\n            children: \"RSC Payload\"\n          }), _jsx(_components.td, {\n            children: \"Client\"\n          }), _jsx(_components.td, {\n            children: \"åœ¨è·¯ç”±å˜åŒ–æ—¶å‡å°‘æœåŠ¡ç«¯è¯·æ±‚\"\n          }), _jsx(_components.td, {\n            children: \"ç”¨æˆ·ä¼šè¯æˆ–åŸºäºæ—¶é—´\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Request Memorization\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Request Memorization æ˜¯å®Œå…¨ç»§æ‰¿è‡ª React çš„è¡Œä¸ºï¼ŒReact åŸºäº fetch API çš„è‡ªåŠ¨ç¼“å­˜ç­–ç•¥å®ç°äº†åœ¨ç»„ä»¶æ ‘ä¸­å¯¹ request çš„ç¼“å­˜ï¼Œè¯¦è§ React æ–‡æ¡£\", _jsx(_components.a, {\n        href: \"https://react.dev/reference/react/cache\",\n        children: \"cache\"\n      }), \"ã€‚åœ¨å¤šä¸ªç»„ä»¶ä¸­è°ƒç”¨åŒä¸€ä¸ªæ¥å£æ—¶ï¼Œå·²æ— éœ€åœ¨æ ¹ç»„ä»¶è°ƒç”¨æ•°æ®ç„¶åä¼ é€’åˆ°å­ç»„ä»¶ï¼Œç›´æ¥åœ¨éœ€è¦æ•°æ®ä¸­çš„ç»„ä»¶è°ƒç”¨ï¼Œreact ä¼šæå–å¹¶ç¼“å­˜ requestï¼ˆåªå¯¹ fetch GET è¯·æ±‚èµ·ä½œç”¨ï¼‰ï¼Œè¿™ä¸ªè¡Œä¸ºåªå‘ç”Ÿåœ¨æœåŠ¡ç«¯ç»„ä»¶ï¼Œä¸”æ‰€æœ‰ react çš„ ssr æ¡†æ¶ä¼šæœ‰ä¸€è‡´çš„è¡Œä¸ºã€‚\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åœ¨ nextjs ä¸­ï¼Œç¼“å­˜åªå‘ç”Ÿåœ¨åŒä¸€æ¬¡è¯·æ±‚å’Œæ¸²æŸ“ä¸­ï¼Œå› æ­¤æ²¡æœ‰æ¸…é™¤ç¼“å­˜çš„å…¥å£å’Œå¿…è¦æ€§ã€‚\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Data Cache\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Next.js å®ç°äº†å¯¹æ„å»ºæ•°æ®å’ŒæœåŠ¡ç«¯è¯·æ±‚æ•°æ®çš„ç¼“å­˜ã€‚ç”±äº Next.js æ˜¯åŸºäº fetch API å®ç°äº†è¯¥æ–¹é¢çš„ç¼“å­˜ï¼Œç”¨æˆ·å¯ä»¥é’ˆå¯¹æ¯ä¸ª fetch è¯·æ±‚è®¾ç½®å‚æ•°æ¥å®ç°ä¸ä¸€æ ·çš„ç¼“å­˜ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰æœåŠ¡ç«¯çš„ fetch è¯·æ±‚éƒ½ä¼šè¢«ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨\", _jsx(_components.code, {\n        children: \"cache\"\n      }), \"å’Œ\", _jsx(_components.code, {\n        children: \"next.revalidate\"\n      }), \"Â  æ“æ§ã€‚\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Next.js ä¼šä¿æŒä½¿ç”¨æ•°æ®ç¼“å­˜ï¼Œé™¤éç”¨æˆ·æ‰‹åŠ¨é‡æ–°éªŒè¯æˆ–ç¦ç”¨ç¼“å­˜ã€‚è§¦å‘é‡æ–°éªŒè¯çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šåŸºäºæ—¶é—´é‡æ–°éªŒè¯ã€æŒ‰éœ€é‡æ–°éªŒè¯ã€‚\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"åŸºäºæ—¶é—´é‡æ–°éªŒè¯\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"é€šè¿‡ fetch æ¥å£åˆ¶å®šæ—¶é—´å‚æ•°æ¥å‘Šè¯‰ next ä½•æ—¶é‡æ–°éªŒè¯ã€‚ç¬¬ä¸€æ¬¡ä»å¤–éƒ¨æ•°æ®æºå–æ•°æ®ä¹‹å next ä¼šå°†æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹å‰é‡æ–°è¯·æ±‚æ•°æ®ï¼Œéƒ½å°†ä»ç¼“å­˜ä¸­æ‹¿ï¼Œè¶…è¿‡æŒ‡å®šæ—¶é—´ä¹‹åä¼šé‡æ–°è®¤è¯å¹¶è¿”å›æœ€æ–°æ•°æ®ï¼Œæ–°ä¸€è½®çš„ç¼“å­˜æ—¶é—´ä»å¤´å¼€å§‹è®¡ç®—ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ—§æ•°æ®ä¼šä¿æŒåˆ°æ–°æ•°æ®æ‹¿åˆ°ä¹‹åæ‰è¢«æ›¿æ¢ï¼Œæœ‰ç‚¹ç±»ä¼¼ stale-while-revalidate çš„è¡Œä¸ºã€‚\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-jsx\",\n        children: \"// Revalidate at most every hour\\nfetch(\\\"https://...\\\", { next: { revalidate: 3600 } });\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"æŒ‰éœ€é‡æ–°éªŒè¯\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"æŒ‰éœ€é‡æ–°è®¤è¯ä¸»è¦é€šè¿‡ä¸¤ä¸ª API å®Œæˆï¼š \", _jsx(_components.code, {\n        children: \"revalidatePath\"\n      }), \" å’Œ\", _jsx(_components.code, {\n        children: \"revalidateTag\"\n      }), \" ï¼Œ\", _jsx(_components.code, {\n        children: \"revalidatePath\"\n      }), \" ç”¨äºæŒ‡å®šæŸä¸ªè·¯ç”±ä¸‹çš„æ•°æ®ç¼“å­˜éœ€è¦é‡æ–°è®¤è¯ï¼Œ\", _jsx(_components.code, {\n        children: \"revalidateTag\"\n      }), \" éœ€è¦é€šè¿‡ fetch çš„\", _jsx(_components.code, {\n        children: \"options.next.tags\"\n      }), \" å‚æ•°æŒ‡å®š tag æ¥ä½¿ç”¨ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ä»å¤–éƒ¨æ•°æ®è¯·æ±‚æ—¶æ•°æ®ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œè°ƒç”¨\", _jsx(_components.code, {\n        children: \"revalidatePath\"\n      }), \" æˆ–\", _jsx(_components.code, {\n        children: \"revalidateTag\"\n      }), \"æ—¶ï¼Œç¼“å­˜ä¼šè¢«æ¸…é™¤ï¼Œå†æ¬¡è¯·æ±‚æ—¶ä¼šä»å¤–éƒ¨æ•°æ®æºæ‹¿æœ€æ–°çš„æ•°æ®ã€‚\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"åœ¨ client ç»„ä»¶è°ƒç”¨\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæœ‰éœ€è¦åœ¨ client ç»„ä»¶ä¸­è§¦å‘é‡æ–°è®¤è¯çš„åœºæ™¯ï¼Œæ¯”å¦‚æ›´æ–°äº†ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œæˆ–ä¿®æ”¹äº†ä¸€äº›æ•°æ®éœ€è¦åŠæ—¶å±•ç¤ºã€‚è€Œ\", _jsx(_components.code, {\n        children: \"revalidatePath\"\n      }), \" å’Œ\", _jsx(_components.code, {\n        children: \"revalidateTag\"\n      }), \"ä¸¤ä¸ªæ–¹æ³•æ˜¯åœ¨æœåŠ¡ç«¯è°ƒç”¨çš„ï¼Œè¿™æ—¶éœ€è¦å£°æ˜\", _jsx(_components.code, {\n        children: \"Server Actions\"\n      }), \"ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è°ƒç”¨è¯¥å‡½æ•°ã€‚\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-jsx\",\n        children: \"\\\"use server\\\";\\n\\nimport { revalidatePath } from \\\"next/cache\\\";\\n\\nexport async function createPost() {\\n  try {\\n    // ...\\n  } catch (error) {\\n    // ...\\n  }\\n\\n  revalidatePath(\\\"/posts\\\");\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"ç¦ç”¨ç¼“å­˜\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"next æä¾›ç»™äº†å‡ ç§æ–¹å¼ç”¨äºå£°æ˜ä¸ä½¿ç”¨ç¼“å­˜\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"ä½¿ç”¨ fetch çš„ no-store å‚æ•°ï¼Œå¯¹äºåœ¨æµè§ˆå™¨å‘å‡ºçš„è¯·æ±‚ï¼Œå£°æ˜ no-store å¯ä»¥ç»•è¿‡å¼ºåˆ¶ç¼“å­˜ï¼Œåœ¨ next æœåŠ¡ç«¯è°ƒç”¨çš„ fetch ä¹Ÿæ²¿ç”¨äº†è¿™ä¸€è®¾å®šã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-jsx\",\n        children: \"// Opt out of caching for an individual `fetch` request\\nfetch(`https://...`, { cache: \\\"no-store\\\" });\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"åœ¨ layout æˆ– page ä¸­å£°æ˜åŠ¨æ€æ¸²æŸ“å‚æ•°\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-jsx\",\n        children: \"const dynamic = \\\"force-dynamic\\\";\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Full Route Cache\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"è¿™ä¸€éƒ¨åˆ†çš„ç¼“å­˜å¯¹è±¡æ˜¯æ„å»ºäº§ç”Ÿçš„ html å’Œ RSC Payloadï¼Œhtml æ¥è‡ªæ„å»ºæ—¶æ³¨å…¥çš„é™æ€æ•°æ®æˆ–é¢„æ¸²æŸ“æ•°æ®ï¼Œå’Œè¯·æ±‚æ—¶åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„ html ç»“æœï¼ŒRSC Payload åˆ™æ˜¯ä¸€ä»½å¤æ‚çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒåŒ…å«äº†æœåŠ¡ç«¯ç»„ä»¶çš„æ¸²æŸ“ç»“æœã€å®¢æˆ·ç«¯ç»„ä»¶çš„å ä½ä¿¡æ¯å’Œ js æ–‡ä»¶ã€ä»æœåŠ¡ç«¯ç»„ä»¶ä¼ é€’åˆ°å®¢æˆ·ç«¯ç»„ä»¶çš„ä»»ä½•å±æ€§ã€‚\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"é‡æ–°éªŒè¯çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼š\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ä¸€ç§æ˜¯é‡æ–°éƒ¨ç½²ï¼Œä¸€ç§æ˜¯é‡æ–°éªŒè¯ç†ç”±ä¸‹çš„ Data Cacheã€‚\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åœ¨ client çš„è·¯ç”±è·³è½¬ä¸­ï¼Œå½“è·³è½¬åˆ°æŸä¸ªè·¯ç”±ä¸‹æ—¶ï¼Œnext å‘é€çš„ GET è¯·æ±‚\", _jsx(_components.code, {\n        children: \"/{path}?_rsc=xxx\"\n      }), \" ï¼Œ_rsc ä»£è¡¨ä¸€ä¸ª cacheKeyï¼Œå½“é‡æ–°éªŒè¯ Data Cache çš„æ—¶å€™ï¼Œä½¿ç”¨è¯¥æ•°æ®æºçš„è·¯ç”±çš„ cacheKey ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå½“è·³è½¬çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯é€šè¿‡ cacheKey çš„å˜åŒ–çŸ¥é“è¯¥å¿½ç•¥ç¼“å­˜ã€‚\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Router Cache\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Router Cache æ˜¯åœ¨å®¢æˆ·ç«¯å¯¹å·²åŠ è½½æˆ–é¢„åŠ è½½çš„è·¯ç”±çš„ç¼“å­˜ï¼Œä¸ Full Router Cache ä¸åŒçš„æ˜¯ï¼šRouter Cache åªåœ¨ç›¸åŒçš„ç”¨æˆ·ä¼šè¯ä¸­ç¼“å­˜ï¼Œæ”¯æŒç¼“å­˜é™æ€æ¸²æŸ“å’ŒåŠ¨æ€æ¸²æŸ“ã€‚\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Router Cache å­˜åœ¨æ•´ä¸ªä¼šè¯æœŸé—´ï¼Œåœ¨åˆ·æ–°é¡µé¢åå¤±æ•ˆã€‚\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"éœ€è¦æ³¨æ„çš„æ˜¯ next.js å†…ç½®äº†åŸºäºæ—¶é—´çš„è¿‡æœŸç­–ç•¥ï¼š\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"é™æ€æ¸²æŸ“å¹¶æŒ‡å®šäº† prefetch çš„è·¯ç”±ï¼Œè¿‡æœŸæ—¶é—´ä¸º 5 åˆ†é’Ÿ\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"prefetch=\", null, \"Â  æˆ–æœªæŒ‡å®šï¼Œæˆ–ä¸ºåŠ¨æ€æ¸²æŸ“çš„é¡µé¢ï¼Œè¿‡æœŸæ—¶é—´ä¸º 30s\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ä»é¡µé¢ä¸Šçš„æ•ˆæœæ¥çœ‹ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´å†…è·³è½¬è·¯ç”±ï¼Œå®¢æˆ·ç«¯ä¹‹é—´æ‹¿ä¹‹å‰çš„ç¼“å­˜æ¸²æŸ“ï¼Œä¸ä¼šå†é‡æ–°è¯·æ±‚æœåŠ¡å™¨ï¼ˆä¸å‘é€\", _jsx(_components.code, {\n        children: \"/{path}?_rsc=xxx\"\n      }), \" è¯·æ±‚ï¼‰ã€‚\"]\n    }), \"\\n\", _jsx(\"aside\", {\n      children: _jsxs(_components.p, {\n        children: [\"ğŸ”‘ åœ¨next@14.2.0-canary.53ä¹‹åçš„ç‰ˆæœ¬ä¸­æ”¯æŒäº†è¿‡æœŸæ—¶é—´çš„è®¾ç½®\\n\", _jsx(_components.a, {\n          href: \"https://nextjs.org/docs/app/api-reference/next-config-js/staleTimes\",\n          children: \"https://nextjs.org/docs/app/api-reference/next-config-js/staleTimes\"\n        })]\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"æ‰‹åŠ¨åºŸå¼ƒ\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"æ‰§è¡Œä»¥ä¸‹ API ä¹Ÿå¯ä»¥æ‰‹åŠ¨åºŸå¼ƒæ‰ç¼“å­˜\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"æœåŠ¡ç«¯ api\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.code, {\n              children: \"revalidatePath\"\n            }), \" æˆ–\", _jsx(_components.code, {\n              children: \"revalidateTag\"\n            })]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.a, {\n              href: \"https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options\",\n              children: _jsx(_components.code, {\n                children: \"cookies.set\"\n              })\n            }), \"Â  æˆ– Â \", _jsx(_components.a, {\n              href: \"https://nextjs.org/docs/app/api-reference/functions/cookies#deleting-cookies\",\n              children: _jsx(_components.code, {\n                children: \"cookies.delete\"\n              })\n            })]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"å®¢æˆ·ç«¯ä¸‹çš„\", _jsx(_components.a, {\n          href: \"https://nextjs.org/docs/app/api-reference/functions/use-router\",\n          children: _jsx(_components.code, {\n            children: \"router.refresh\"\n          })\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"æ€»ç»“\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"è™½ç„¶ç¼“å­˜åˆ† 4 ç§ï¼Œä½†æ¯ç§ç¼“å­˜ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œå½“ä½ é€šè¿‡æŸä¸ª API é‡æ–°éªŒè¯æŸä¸€ç±»ç¼“å­˜æ—¶ï¼Œå…¶ä»–ç¼“å­˜ä¹Ÿå¯èƒ½è·Ÿç€è¢«æ›´æ–°ï¼Œå› æ­¤éœ€è¦æ ¹æ®å…·ä½“çš„ä½¿ç”¨æƒ…å†µå’Œç°è±¡æ¥åˆ†æå¹¶ç¡®è®¤æœ€ä½³ä½¿ç”¨æ–¹å¼ã€‚\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"å»¶ç”³æ€è€ƒ\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Next.js çš„ APP Router ç¡®å®æ¯”è¾ƒéš¾ç”¨ï¼Œæœ‰åˆ«äºä¼ ç»Ÿçš„ SPA åº”ç”¨ï¼Œåœ¨å¼€å‘ next åº”ç”¨æ—¶æˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘ä»£ç æˆ–ç»„ä»¶å“ªäº›éƒ¨åˆ†å·¥ä½œåœ¨å®¢æˆ·ç«¯å“ªäº›éƒ¨åˆ†å·¥ä½œåœ¨æœåŠ¡ç«¯ï¼Œä½†å®ƒç¡®å®æä¾›äº†å¾ˆå¤šæ€§èƒ½ä¼˜åŒ–çš„ä¼˜è´¨å®è·µæ–¹å¼ã€‚åœ¨å¯¹ Next.js æ›´æ·±å…¥çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œè¿˜èƒ½å‘ç°ä¸€äº› React å®˜æ–¹æœ€æ–°æä¾›çš„å®éªŒæ€§ API å’Œä¸€äº›æœªæ¥å‘å±•çš„è¶‹åŠ¿ã€‚\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"å‚è€ƒèµ„æ–™\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://nextjs.org/docs/app/building-your-application/caching#data-cache\",\n        children: \"Next.js æ–‡æ¡£- App Router-Caching\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://nextjs.org/docs/app/building-your-application/caching#apis\",\n        children: \"ä¸ç¼“å­˜ç›¸å…³çš„ API\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://github.com/vercel/next.js/discussions/54075\",\n        children: \"Github discussion ä¸­å¯¹ç¼“å­˜çš„æ·±åº¦è®¨è®º\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{"title":"Next.js ä¸­App Routerçš„ç¼“å­˜ç­–ç•¥","date":"2024-6-18 18:30","description":"Next.js ä¸­App Routerçš„ç¼“å­˜ç­–ç•¥çš„å½’çº³å’Œä½¿ç”¨","public":true,"category":"framework","cover":"/posts-img/caching-overview.jpg"}},"frontMatter":{"title":"Next.js ä¸­App Routerçš„ç¼“å­˜ç­–ç•¥","date":"2024-6-18 18:30","description":"Next.js ä¸­App Routerçš„ç¼“å­˜ç­–ç•¥çš„å½’çº³å’Œä½¿ç”¨","public":true,"category":"framework","cover":"/posts-img/caching-overview.jpg"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"next-cache-strategy"},"buildId":"NYhGD9KYsWK6ZpgmhG3ox","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>