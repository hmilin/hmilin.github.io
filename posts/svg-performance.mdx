---
title: 图编辑页面性能优化
date: "2024-03-6 20:10:00"
description:
public: false
---

## 主要对象介绍

- 节点
- 连线： 表示节点之间的调用关系，和节点为1对多的关系
- 分组：一组节点和连线，可以展开和折叠
- 子图：一种特殊的节点类型，表示引用其他图，展开时会将子图加载出来

## 性能方面存在的问题

1. 当节点和连线越多，拖拽响应速度越慢，超过几十个节点即有明显的卡顿
2. 连线过程的预渲染也有明显的卡顿

## 优化目标

根据实际业务需求，节点表示微服务，连接表示引用关系，在大多数生产使用中节点不会特别多，连接会很多，因此测试数据定为：50个节点+340根线

- 组件拖拽不卡顿
- 连线过程不卡顿
- 线编辑不卡顿

## 原因分析

1. 厚重的selector层，节点数据修改时会重构整个节点数据，根据分组和子图递归计算
2. 由于每次节点和连线数据都是重新计算，节点拖拽过程中的每一帧，所有组件都会更新
3.

## 优化点


## 检测标准

1. 通过Performance 录制，对比相同数据量相同操作下的浏览器任务处理时间和掉帧率
2. 使用`React Dev Tool`直观看出组件是否存在不必要的更新

## 测试工具

### React Tool

### Chrome Performance

#### Frame类型

- Frame： 按预期程序
- Partially presented Frame （黄色）： Chrome 已尽最大努力及时至少呈现一些外观更新。例如，如果渲染器进程的主线程（画布动画）的工作延迟，但合成器线程（滚动）及时
- Dropped Frame（红色）：无法在合理的时间内即时呈现
